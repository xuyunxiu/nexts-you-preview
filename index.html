<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>NEXT'S YOU â€” Preview (Polished UI)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <!-- é˜²å¿«å– -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- === INS-Neumorphism Theme Pack (paste just before </body>) === -->
<!-- === NX THEME CORE (drop-in, no layout/logic changes) === -->
<style>
  /* ä¸»é¡ŒåŸºåº•ï¼šå…©å¥—èª¿è‰²ç›¤ */
  :root { --theme: dark; }
  :root[data-theme="dark"]{
    --bg:#0e0e10; --card:#141417; --hover:#1a1a1f; --border:rgba(255,255,255,.06);
    --text:#f5f5f5; --sub:#a1a1aa; --muted:#777781;
    --accent:#ff2d55; --accent-2:#ff335a; --success:#2ecc71; --danger:#ff5a5f;
    --radius:14px; --radius-sm:10px; --shadow:0 6px 20px rgba(0,0,0,.45); --ring:0 0 0 2px rgba(255,45,85,.25);
  }
  :root[data-theme="light"]{
    --bg:#fafafa; --card:#ffffff; --hover:#f5f6f8; --border:rgba(0,0,0,.08);
    --text:#111114; --sub:#3b3b44; --muted:#7a7a86;
    --accent:#ff2d55; --accent-2:#ff335a; --success:#16a34a; --danger:#ef4444;
    --radius:14px; --radius-sm:10px; --shadow:0 6px 18px rgba(0,0,0,.12); --ring:0 0 0 2px rgba(255,45,85,.25);
  }

  /* è®“é¡è‰²ä¸€å®šåƒåˆ°ï¼ˆè§£ä½ â€œæ·±è‰²å­—æ²’è®Šç™½â€çš„ç‹€æ³ï¼‰ */
  html, body, section, nav, .card, .friendCard, .bubble, .pill, .topbar, .live-stage, .live-hero,
  .live-feed, .textbox, .neo-input, input, textarea, button, .tabs button, .date-chip {
    color: var(--text) !important;
  }
  a { color: var(--accent); }

  /* èƒŒæ™¯èˆ‡æ¼¸å±¤ï¼ˆä¿ç•™ IG é¢¨ï¼‰ */
  html,body{background:
    radial-gradient(1200px 800px at 90% -10%, rgba(255,45,85,.08), transparent 50%),
    radial-gradient(900px 700px at 10% 110%, rgba(109,40,217,.08), transparent 50%),
    var(--bg) !important;
  }

  /* å¡ç‰‡/è¡¨å±¤åº•è‰²ï¼ˆä¸è®Šå‹•ä½ çš„ç‰ˆä½ï¼Œåªæ›çš®ï¼‰ */
  .card, .friendCard, .pill, .tabs button { background: var(--card); border:1px solid var(--border); }
  .tabs button.active{ background: linear-gradient(180deg, var(--hover), var(--card)); color: var(--text) !important; border-color: transparent; box-shadow: var(--shadow); }
  .textbox, input[type="text"], textarea{ background: var(--hover); border:1px solid var(--border); color: var(--text) !important; }
  .send-btn, .friendCard .action{ background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#fff !important; }

  /* æ°›åœç´°ç¯€ */
  .small{ color: var(--muted) !important; }
  .muted, .friendCard .hint, .live-msg .time{ color: var(--sub) !important; }
</style>

<script>
  // ===== ä¸»é¡Œæ§åˆ¶æ ¸å¿ƒ =====
  (function(){
    const root = document.documentElement;

    // 1) åˆå§‹ï¼šç”¨ localStorageï¼›æ²’æœ‰å‰‡è·Ÿéš¨ç³»çµ±
    const saved = localStorage.getItem('nx-theme');
    if(saved){ root.setAttribute('data-theme', saved); }
    else{
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
    }

    // 2) å°å¤– APIï¼ˆä¸æ”¾ UI æŒ‰éˆ•ï¼Œåªæä¾›å‘¼å«ï¼‰
    window.NX = window.NX || {};
    window.NX.setTheme = function(theme){
      if(theme!=='dark' && theme!=='light') return;
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('nx-theme', theme);
      // å°å»¶é²å¼·åˆ¶é‡ç¹ªï¼Œé¿å…æŸäº› iOS WebView æ²’å³æ™‚å¥—è‰²
      setTimeout(()=>{ document.documentElement.style.transform='translateZ(0)'; requestAnimationFrame(()=>{ document.documentElement.style.transform=''; }); }, 0);
    };

    // 3) è·Ÿéš¨ç³»çµ±ï¼ˆè‹¥ä½¿ç”¨è€…æ²’æ‰‹å‹•é¸éï¼‰
    if(!saved && window.matchMedia){
      try{
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e=>{
          root.setAttribute('data-theme', e.matches ? 'dark' : 'light');
        });
      }catch(_){}
    }
  })();
</script>
<!-- === /NX THEME CORE === -->

<!-- æµ®å‹•ä¸»é¡Œåˆ‡æ›ï¼ˆé»ä¸€ä¸‹ Purple / Black åˆ‡æ›ï¼‰ -->
<button id="themeBtn" class="neo-card float-toggle" aria-label="Toggle Theme">ğŸŸ£</button>

<script>
  /* --- ä¸»é¡Œåˆ‡æ›ï¼ˆé è¨­ Blackï¼›é»æŒ‰åˆ‡ Purpleï¼‰ --- */
  (function(){
    const root = document.documentElement;
    const saved = localStorage.getItem('neoTheme'); if(saved==='purple') root.classList.add('purple');
    const btn = document.getElementById('themeBtn');
    const setIcon = ()=> btn.textContent = root.classList.contains('purple') ? 'âš«' : 'ğŸŸ£';
    setIcon();
    btn.onclick = ()=>{
      root.classList.toggle('purple');
      localStorage.setItem('neoTheme', root.classList.contains('purple') ? 'purple' : 'black');
      setIcon();
    };
  })();

  /* --- è‡ªå‹•æŠŠç¾æœ‰é é¢å…ƒç´ å¥—ä¸Šæ–°å¤–è§€ï¼ˆå…æ”¹ä½ çš„çµæ§‹ï¼‰ --- */
  (function applySkin(){
    // é ‚éƒ¨å€å¡Š/ä¸»è¦å®¹å™¨
    ['home','dm','live','wallet','gallery','profile','login'].forEach(id=>{
      const el = document.getElementById(id);
      if(el){ el.classList.add('neo-wrap'); }
    });

    // DMï¼šè¨Šæ¯åˆ—è¡¨çš„æ¯æ¢è¨Šæ¯ï¼ˆä½ åŸæœ¬çš„ .msg / .msg.me / .msg.sub æœƒè‡ªå‹•å¥—æ¨£ï¼‰
    document.querySelectorAll('.msg').forEach(m=> m.classList.add('bubble'));
    document.querySelectorAll('.msg.me').forEach(m=> m.classList.add('me'));
    document.querySelectorAll('.msg.sub').forEach(m=> m.classList.add('sub'));

    // é€å‡º / ä¸»è¦å‹•ä½œæŒ‰éˆ•
    document.querySelectorAll('button, .btn').forEach(b=>{
      const label = (b.textContent||'').trim();
      if(/é€å‡º|é–‹å§‹èŠå¤©|è³¼è²·|ç™¼ä½ˆ|Buy|Start/i.test(label)) b.classList.add('neo-btn');
      else b.classList.add('neo-item','neo-ghost');
    });

    // è¼¸å…¥æ¡†
    document.querySelectorAll('input[type="text"], input[type="search"], textarea').forEach(i=> i.classList.add('neo-input'));

    // å¥½å‹/è—äººåˆ—è¡¨é …ï¼ˆçŒœæ¸¬åˆ—è¡¨å®¹å™¨ idï¼‰
    const friendList = document.getElementById('friendList') || document.querySelector('.friendList');
    if(friendList){
      friendList.querySelectorAll('div').forEach(row=>{
        // è‹¥å…§å«åœ–ç‰‡å°±è¦–ç‚º friend-card
        if(row.querySelector('img')){
          row.classList.add('friend-card','neo-item');
          const name = row.querySelector('strong, .name, span');
          if(name) name.classList.add('friend-name');
        }else{
          row.classList.add('neo-item');
        }
      });
    }

    // è† å›Šå¾½ç« ï¼ˆâ™¡+Nã€æ—¥æœŸè† å›Šï¼‰ï¼šä¾ä½ åŸæœ¬çµæ§‹é™„åŠ  .neo-pill
    document.querySelectorAll('.pill,.hearts,.date-pill,.badge').forEach(p=> p.classList.add('neo-pill'));

    // é ‚å€å¤§å¡ï¼ˆé¦–é  banner / å€å¡Šï¼‰åŠ  .neo-card
    document.querySelectorAll('.card,.panel,.section-card,.product,.live-host, .dm-header').forEach(c=> c.classList.add('neo-card'));
  })();
</script>
<!-- === /INS-Neumorphism Theme Pack === -->
</head>
<body>

<!-- LOGIN -->
<section id="login" class="active">
  <div class="panel soft" style="padding:18px">
    <h2 style="margin-bottom:8px">ç™»å…¥</h2>
    <button class="btn btn-red" onclick="login('line')">ç”¨ LINE ç™»å…¥ï¼ˆæ¨¡æ“¬ï¼‰</button>
    <div style="margin-top:8px">
      <input id="inviteCode" placeholder="è¼¸å…¥é‚€è«‹ç¢¼ï¼Œä¾‹å¦‚ NEXT2025" style="width:70%;max-width:320px">
      <button class="btn" onclick="login('code')">ä½¿ç”¨é‚€è«‹ç¢¼</button>
    </div>
  </div>
</section>

<!-- HOME -->
<section id="home">
  <div id="friendsHeader" class="panel soft">
    <div class="me">
      <img id="userAvatar" src="https://picsum.photos/80?u=me" alt="é ­è²¼" onclick="openProfile()">
      <div class="nick" id="nickname" onclick="openProfile()">æš±ç¨±</div>
    </div>
    <button class="btn" onclick="showPage('wallet')">éŒ¢åŒ…</button>
  </div>

  <div class="tabs">
    <button id="tab-artists" class="active" onclick="setHomeTab('artists')">è—äºº</button>
    <button id="tab-groups" onclick="setHomeTab('groups')">åœ˜é«”</button>
    <button id="tab-purchased" onclick="setHomeTab('purchased')">å·²è³¼è²·</button>
    <button id="tab-unpurchased" onclick="setHomeTab('unpurchased')">æœªè³¼è²·</button>
  </div>

  <div id="homeList" class="grid"></div>
  <div id="homeEmpty" class="ghost" style="padding:12px;display:none">é€™ä¸€é¡ç›®å‰æ˜¯ç©ºçš„ï½</div>
</section>

<!-- PROFILE -->
<section id="profile">
  <div class="topbar"><h2>æˆ‘çš„å€‹äººé </h2></div>
  <div class="panel soft" style="padding:16px; text-align:center">
    <img id="editAvatar" src="https://picsum.photos/160?u=me" style="width:96px;height:96px;border-radius:20px;object-fit:cover; border:1px solid var(--line)"><br/>
    <div style="margin:10px 0">
      <input type="file" id="avatarInput" accept="image/*" onchange="changeAvatar(event)">
    </div>
    <div>
      <input type="text" id="editNickname" placeholder="è¼¸å…¥æš±ç¨±" style="width:70%;max-width:320px">
      <button class="btn btn-red" onclick="saveProfile()">å„²å­˜</button>
    </div>
    <p class="ghost" style="margin:10px 0 0"><b>ç²‰çµ² IDï¼š</b><span id="fanId"></span></p>
    <div style="margin-top:10px"><button class="btn" onclick="showPage('home')">è¿”å› Friends</button></div>
  </div>
</section>

<!-- DM LIST -->
<section id="dmList">
  <div class="topbar"><h2>Messages</h2></div>
  <div id="dmListWrap" class="list-col"></div>
  <div id="dmListEmpty" class="ghost" style="margin-top:12px;display:none">
    ç›®å‰æ²’æœ‰å·²é–‹é€šçš„ DMã€‚<button class="btn btn-red" onclick="showPage('wallet')">å»éŒ¢åŒ…é–‹é€š</button>
  </div>
</section>

<!-- DM CHAT -->
<section id="dm">
  <div class="topbar">
    <div class="dm-top">
      <button class="btn btn-ghost" onclick="showPage('dmList')">â€¹ è¿”å›</button>
      <div class="dm-title" id="dmTitle">ALLDAY PROJECT â€” åœ˜é«” DM</div>
    </div>
    <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
      <button class="menu-btn" onclick="openGallery()">â–¦</button>
      <div class="pill"><b>â™¡</b><span id="heartDays">+0</span></div>
    </div>
  </div>

  <div class="dm-wrap">
    <div id="dm-messages" class="dm-messages"></div>
    <div class="dm-input">
      <input id="dmInput" placeholder="è¼¸å…¥è¨Šæ¯â€¦">
      <button onclick="sendMessage()">â¤</button>
    </div>
  </div>
</section>

<!-- GALLERY (åƒ… â–¦ é€²) -->
<section id="gallery">
  <div class="topbar">
    <h2>ç›¸ç°¿</h2>
    <div style="margin-left:auto"><button class="btn" onclick="showPage('dm')">è¿”å› DM</button></div>
  </div>
  <div id="galleryGrid"></div>
</section>

<!-- LIVE -->
<section id="live">
  <div class="topbar"><h2>LIVE</h2></div>
  <div class="live-host">
    <div class="title">ä¸»æ’­è¨Šæ¯</div>
    <div id="liveHostMsg" style="font-size:18px;line-height:1.55;margin-top:6px;min-height:40px">ç­‰å¾…é–‹æ’­â€¦</div>
    <div id="liveHostTime" class="ghost" style="margin-top:6px;font-size:12px"></div>
  </div>

  <div id="liveFans" class="live-fans"></div>

  <div style="position:sticky;bottom:96px; display:flex; gap:10px; margin-top:10px">
    <input id="liveInput" placeholder="ç™¼é€ç•™è¨€â€¦" style="flex:1; border:none; border-radius:12px; padding:12px; background:#101114; color:#fff; box-shadow:inset 0 0 0 1px #24262c">
    <button class="btn btn-red" onclick="fanSendLive()">é€å‡º</button>
  </div>
</section>

<!-- WALLET -->
<section id="wallet">
  <div class="topbar"><h2>éŒ¢åŒ…</h2><div style="margin-left:auto"><button class="btn" onclick="logout()">ç™»å‡º</button></div></div>
  <div class="panel soft" style="padding:14px">
    <p><b>æˆ‘çš„åˆ†æ•¸ï¼š</b><span id="points">0</span></p>
    <div class="product">
      <h4>7 å¤© DM æ¬Šç›Š â€” 70 åˆ†</h4><button class="btn btn-red" onclick="buyProduct(70,7)">è³¼è²·</button>
    </div>
    <div class="product">
      <h4>30 å¤© DM æ¬Šç›Š â€” 250 åˆ†</h4><button class="btn btn-red" onclick="buyProduct(250,30)">è³¼è²·</button>
    </div>

    <h3 style="margin:18px 0 6px">æ¸¬è©¦è³¼è²·æ·å¾‘</h3>
    <div class="product"><p>è³¼è²·ã€Œåœ˜é«”ã€pass</p><button class="btn btn-red" onclick="markPurchased('group',true)">æ¨™è¨˜å·²è³¼è²·ï¼ˆåœ˜é«”ï¼‰</button></div>
    <div class="product"><p>è³¼è²·ã€ŒWOOCHANã€</p><button class="btn btn-red" onclick="markPurchased('wc',true)">æ¨™è¨˜å·²è³¼è²·ï¼ˆWOOCHANï¼‰</button></div>
  </div>
</section>

<!-- æˆªåœ–è­¦å‘Š MODALï¼ˆé¦–æ¬¡é€² DM é¡¯ç¤ºä¸€æ¬¡ï¼‰ -->
<div id="shotModal" class="modal">
  <div class="box">
    <h3>æˆªåœ–è­¦å‘Šï¼ˆScreenshot Warningï¼‰</h3>
    <div class="warn">
      âš ï¸ ä½ åœ¨èŠå¤©å®¤å…§çš„æˆªåœ–ã€è½‰å‚³ã€å¤–æµéƒ½å¯èƒ½å°è‡´æ¬Šç›Šè¢«åœç”¨ã€‚è«‹å°Šé‡å‰µä½œè€…èˆ‡ç¤¾ç¾¤æˆå“¡ã€‚
    </div>
    <p class="ghost" style="margin:8px 0 0">We protect artists and fans. Unauthorized capture/redistribution is prohibited.</p>
    <div class="actions">
      <button class="btn" onclick="dismissShot()">æˆ‘çŸ¥é“äº†</button>
      <button class="btn btn-red" onclick="dismissShot(true)">ä¸å†æç¤º</button>
    </div>
  </div>
</div>

<!-- NAV -->
<nav id="nav" class="hidden">
  <button onclick="showPage('home')">é¦–é </button>
  <button onclick="showPage('dmList')">DM</button>
  <button onclick="showPage('live')">ç›´æ’­</button>
  <button onclick="showPage('wallet')">éŒ¢åŒ…</button>
</nav>

<script>
/* ===== DATA ===== */
const ARTISTS = [
  {id:'wc', name:'WOOCHAN', avatar:'https://picsum.photos/120?u=wc', kind:'artist'},
  {id:'ys', name:'YOUNGSEO', avatar:'https://picsum.photos/120?u=ys', kind:'artist'},
  {id:'an', name:'ANNIE',    avatar:'https://picsum.photos/120?u=an', kind:'artist'},
  {id:'ba', name:'BAILEY',   avatar:'https://picsum.photos/120?u=ba', kind:'artist'},
];
const GROUPS = [{id:'group', name:'ALLDAY PROJECT', avatar:'https://picsum.photos/120?u=grp', kind:'group'}];

/* ===== STATE ===== */
if(!localStorage.getItem('points')) localStorage.setItem('points', 200);
if(!localStorage.getItem('userId')) localStorage.setItem('userId','u_'+Math.random().toString(36).slice(2,10));

/* ===== LOGIN & NAV ===== */
function login(m){
  if(m==='line' || (m==='code' && document.getElementById('inviteCode').value.trim()==='NEXT2025')){
    localStorage.setItem('loggedIn','true');
    if(!localStorage.getItem('fanId')) localStorage.setItem('fanId','FAN'+Math.floor(Math.random()*100000));
    showPage('home');
  }else alert('é‚€è«‹ç¢¼éŒ¯èª¤ï¼');
}
function logout(){ localStorage.removeItem('loggedIn'); showPage('login'); }

function showPage(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const nav=document.getElementById('nav');
  if(localStorage.getItem('loggedIn') && id!=='login') nav.classList.remove('hidden'); else nav.classList.add('hidden');

  // è‡ªå‹•åˆ·æ–°
  if(id==='home'){ renderProfile(); setHomeTab(HOME_TAB||'artists'); }
  if(id==='dmList'){ renderDMList(); }
  if(id==='dm'){ renderHearts(); renderDM(); maybeWarnShot(); }
  if(id==='gallery'){ renderGallery(); }
  if(id==='wallet'){ renderPoints(); }
  if(id==='profile'){ prepProfile(); }
}

/* ===== PROFILE ===== */
function renderProfile(){
  document.getElementById('nickname').textContent = localStorage.getItem('nickname') || 'æš±ç¨±';
  document.getElementById('userAvatar').src = localStorage.getItem('avatar') || 'https://picsum.photos/80?u=me';
}
function openProfile(){ showPage('profile'); }
function prepProfile(){
  document.getElementById('editNickname').value = localStorage.getItem('nickname') || 'æš±ç¨±';
  document.getElementById('editAvatar').src = localStorage.getItem('avatar') || 'https://picsum.photos/160?u=me';
  document.getElementById('fanId').textContent = localStorage.getItem('fanId');
}
function changeAvatar(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader(); r.onload = ev => { document.getElementById('editAvatar').src = ev.target.result; }; r.readAsDataURL(f);
}
function saveProfile(){
  const name=document.getElementById('editNickname').value.trim();
  if(name) localStorage.setItem('nickname', name);
  localStorage.setItem('avatar', document.getElementById('editAvatar').src);
  showPage('home');
}

/* ===== HOME LIST & FILTER ===== */
let HOME_TAB='artists';
function setHomeTab(tab){
  HOME_TAB=tab;
  ['artists','groups','purchased','unpurchased'].forEach(t=>document.getElementById('tab-'+t).classList.toggle('active', t===tab));
  renderHome();
}
function isPurchased(id){
  if(id==='group') return passActive();
  const p=JSON.parse(localStorage.getItem('purchases')||'{}'); return !!p[id];
}
function renderHome(){
  const list=document.getElementById('homeList'); const empty=document.getElementById('homeEmpty');
  let dataset=[];
  if(HOME_TAB==='artists') dataset=ARTISTS;
  if(HOME_TAB==='groups') dataset=GROUPS;
  if(HOME_TAB==='purchased') dataset=[...GROUPS,...ARTISTS].filter(i=>isPurchased(i.id));
  if(HOME_TAB==='unpurchased') dataset=[...GROUPS,...ARTISTS].filter(i=>!isPurchased(i.id));

  list.innerHTML = dataset.map(i=>`
    <div class="card" onclick="homeCardClick('${i.id}')">
      <div class="row">
        <img src="${i.avatar}" onerror="this.src='https://picsum.photos/120?u=${i.id}'">
        <div>
          <div><b>${i.name}</b></div>
          <div class="badge ${isPurchased(i.id)?'ok':'ng'}">${isPurchased(i.id)?'å·²è³¼è²·':'æœªè³¼è²·'}</div>
        </div>
      </div>
    </div>`).join('');
  empty.style.display = dataset.length ? 'none' : 'block';
}
function homeCardClick(id){ if(isPurchased(id)) openDM(id); else showPage('wallet'); }

/* ===== WALLET ===== */
function renderPoints(){ document.getElementById('points').textContent = localStorage.getItem('points')||'0'; }
function buyProduct(cost, days){
  let p=parseInt(localStorage.getItem('points')||'0',10);
  if(p<cost) return alert('åˆ†æ•¸ä¸è¶³ï¼');
  p-=cost; localStorage.setItem('points',p);
  localStorage.setItem('purchaseDate', new Date().toISOString().split('T')[0]);
  localStorage.setItem('duration', days);
  alert(`âœ… å·²è³¼è²· ${days} å¤© DM æ¬Šç›Šï¼`); renderPoints(); renderHearts();
}
function markPurchased(id, yes=true){
  const map=JSON.parse(localStorage.getItem('purchases')||'{}'); map[id]=!!yes;
  localStorage.setItem('purchases', JSON.stringify(map));
  alert(`å·²æ¨™è¨˜ ${id} ç‚º ${yes?'å·²è³¼è²·':'æœªè³¼è²·'}`);
}

/* ===== DM LIST & GATING ===== */
function passActive(){
  const start=localStorage.getItem('purchaseDate'); const dur=parseInt(localStorage.getItem('duration')||'0',10);
  if(!start||dur<=0) return false;
  const s=new Date(start), t=new Date(); s.setHours(0,0,0,0); t.setHours(0,0,0,0);
  return Math.floor((t-s)/86400000) <= dur;
}
function renderDMList(){
  const box=document.getElementById('dmListWrap'); const empty=document.getElementById('dmListEmpty');
  const active=passActive();
  const items=[...GROUPS, ...ARTISTS];
  box.innerHTML = items.map(it=>`
    <div class="card" onclick="enterDMFromList('${it.id}')">
      <div class="row">
        <img src="${it.avatar}">
        <div>
          <div><b>${it.name}</b></div>
          <div class="badge ${(it.id==='group'?active:isPurchased(it.id))?'ok':'ng'}">${(it.id==='group'?active:isPurchased(it.id))?'å¯é€²å…¥':'æœªé–‹é€š'}</div>
        </div>
      </div>
    </div>`).join('');
  empty.style.display = (active || Object.values(JSON.parse(localStorage.getItem('purchases')||'{}')).some(Boolean)) ? 'none' : 'block';
}
function enterDMFromList(id){
  if(id==='group'){ if(!passActive()) return showPage('wallet'); }
  else if(!isPurchased(id)) return showPage('wallet');
  openDM(id);
}

/* ===== DM / GALLERY ===== */
function currentArtist(){ return localStorage.getItem('currentArtist') || 'group'; }
function dmKey(){ return `dm_${localStorage.getItem('userId')}_${currentArtist()}`; }
function galleryKey(){ return `gallery_${currentArtist()}`; }

function openDM(id){
  localStorage.setItem('currentArtist', id||'group');
  const title = id==='group' ? 'ALLDAY PROJECT â€” åœ˜é«” DM' : (ARTISTS.find(a=>a.id===id)?.name + ' â€” DM');
  document.getElementById('dmTitle').textContent = title || 'DM';
  showPage('dm');
}

function passStartTS(){ const d=localStorage.getItem('purchaseDate'); if(!d) return null; const s=new Date(d); s.setHours(0,0,0,0); return s.getTime(); }

function renderDM(){
  if(!localStorage.getItem(dmKey())){
    localStorage.setItem(dmKey(), JSON.stringify([{role:'artist',type:'text',text:'æ­¡è¿ä¾†åˆ° DMï¼',trans:'Welcome to DM!',ts:Date.now()}]));
  }
  const list=JSON.parse(localStorage.getItem(dmKey())||'[]');
  const showFrom = currentArtist()==='group' ? passStartTS() : (isPurchased(currentArtist())?0:Infinity);
  const box=document.getElementById('dm-messages'); box.innerHTML='';

  let lastDate='';
  list.filter(m=>!showFrom || (m.ts||0)>=showFrom).forEach(m=>{
    const d=new Date(m.ts||Date.now());
    const D=`${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
    const hh=d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    if(D!==lastDate){ const chip=document.createElement('div'); chip.className='date-chip'; chip.textContent=D; box.appendChild(chip); lastDate=D; }

    const wrap=document.createElement('div'); wrap.className='msg '+(m.role==='fan'?'me':'artist');
    if(m.type==='image'){
      const img=new Image(); img.src=m.url; img.style="max-width:100%;border-radius:12px;border:1px solid #e5e5e5";
      wrap.appendChild(img);
      if(m.caption){ const c=document.createElement('div'); c.className='sub-balloon'; c.textContent=m.caption; wrap.appendChild(c); }
    }else{
      const main=document.createElement('div'); main.textContent=m.text||''; wrap.appendChild(main);
      if(m.role==='artist' && m.trans){ const sub=document.createElement('div'); sub.className='sub-balloon'; sub.textContent=m.trans; wrap.appendChild(sub); }
    }
    const t=document.createElement('time'); t.textContent=hh; wrap.appendChild(t);
    box.appendChild(wrap);
  });
  requestAnimationFrame(()=>{ box.scrollTop = box.scrollHeight; });
}
function sendMessage(){
  const inp=document.getElementById('dmInput'); const t=(inp.value||'').trim(); if(!t) return;
  const list=JSON.parse(localStorage.getItem(dmKey())||'[]');
  list.push({role:'fan',type:'text',text:t,ts:Date.now()});
  localStorage.setItem(dmKey(), JSON.stringify(list)); inp.value=''; renderDM();
}
/* for console tests */
function addArtistMessage(text,translation){
  const dm=JSON.parse(localStorage.getItem(dmKey())||'[]'); dm.push({role:'artist',type:'text',text,trans:translation||'',ts:Date.now()});
  localStorage.setItem(dmKey(), JSON.stringify(dm)); renderDM();
}
function addArtistImage(url,caption){
  const dm=JSON.parse(localStorage.getItem(dmKey())||'[]'); dm.push({role:'artist',type:'image',url,caption:caption||'',ts:Date.now()});
  localStorage.setItem(dmKey(), JSON.stringify(dm));
  const gal=JSON.parse(localStorage.getItem(galleryKey())||'[]'); gal.push({url,caption:caption||'',ts:Date.now()});
  localStorage.setItem(galleryKey(), JSON.stringify(gal)); renderDM();
}

function openGallery(){ showPage('gallery'); renderGallery(); }
function renderGallery(){
  const grid=document.getElementById('galleryGrid');
  const list=JSON.parse(localStorage.getItem(galleryKey())||'[]');
  grid.innerHTML = list.length? list.slice().reverse().map(i=>`<img src="${i.url}" onerror="this.src='https://picsum.photos/400?ph'">`).join('') : '<div class="ghost">é‚„æ²’æœ‰ç…§ç‰‡</div>';
}

/* ===== LIVE ===== */
function hostPushLive(text){
  document.getElementById('liveHostMsg').textContent = text;
  document.getElementById('liveHostTime').textContent = new Date().toLocaleString();
}
function fanSendLive(){
  const inp=document.getElementById('liveInput'); const t=(inp.value||'').trim(); if(!t) return;
  const box=document.getElementById('liveFans');
  const item=document.createElement('div'); item.className='fan-item';
  item.innerHTML=`<b>${localStorage.getItem('nickname')||'ç²‰çµ²'}</b><div style="opacity:.9">${t}</div>
                  <div style="font-size:12px;opacity:.6;margin-top:4px">${new Date().toLocaleTimeString()}</div>`;
  box.appendChild(item); box.scrollTop=box.scrollHeight; inp.value='';
}

/* ===== HEARTS ===== */
function renderHearts(){
  const el=document.getElementById('heartDays'); if(!el) return;
  const start=localStorage.getItem('purchaseDate'); const dur=parseInt(localStorage.getItem('duration')||'0',10);
  if(!start||dur<=0){ el.textContent='+0'; return; }
  const s=new Date(start), t=new Date(); s.setHours(0,0,0,0); t.setHours(0,0,0,0);
  const n=Math.floor((t-s)/86400000); el.textContent = (n<=dur)?`+${n}`:'+0';
}

/* ===== SCREENSHOT WARNING ===== */
function maybeWarnShot(){
  const key='shotWarnDismissed';
  if(localStorage.getItem(key)==='true') return;
  document.getElementById('shotModal').style.display='grid';
}
function dismissShot(remember=false){
  if(remember) localStorage.setItem('shotWarnDismissed','true');
  document.getElementById('shotModal').style.display='none';
}

/* ===== BOOT ===== */
window.addEventListener('load', ()=>{ if(localStorage.getItem('loggedIn')) showPage('home'); else showPage('login'); });
</script>
 <!-- ğŸš€ é–‹å ´å‹•ç•«ï¼šNEXT å›ºå®š + 'S YOU ç¿»è½‰å‡ºç¾ -->
<div id="splash">
  <div class="stage">
    <span class="next">NEXT</span>
    <span id="one" class="one">ONE</span>
    <span id="syou" class="syou">â€™S YOU</span>
  </div>
</div>

<style>
  #splash {
    position: fixed; inset: 0; background: #000;
    display: flex; justify-content: center; align-items: center;
    z-index: 9999;
  }
  .stage {
    font-weight: 700; font-size: 44px; color: #fff;
    display: flex; gap: 20px; align-items: center;
  }
  .next { color: #fff; }
  .one { opacity: 0; }
  .syou { opacity: 0; color: #e42323; transform: rotateY(90deg); }

  /* å‹•ç•«å®šç¾© */
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  @keyframes fadeOut { from{opacity:1} to{opacity:0} }
  @keyframes flipIn {
    from { opacity:0; transform: rotateY(90deg); }
    to   { opacity:1; transform: rotateY(0deg); }
  }
</style>

<script>
  const one = document.getElementById("one");
  const syou = document.getElementById("syou");
  const splash = document.getElementById("splash");

  // Step 1: é¡¯ç¤º NEXT ONE
  one.style.animation = "fadeIn 600ms ease forwards";

  // Step 2: ONE æ¶ˆå¤±ï¼Œ'S YOU ç¿»è½‰é€²å ´
  setTimeout(()=>{
    one.style.animation = "fadeOut 400ms ease forwards";
    setTimeout(()=>{
      syou.style.animation = "flipIn 600ms ease forwards";
    }, 400);
  }, 1200);

  // Step 3: æœ€å¾Œæ·¡å‡ºæ•´å€‹é–‹å ´
  setTimeout(()=>{
    splash.style.transition = "opacity 400ms ease";
    splash.style.opacity = "0";
    setTimeout(()=> splash.remove(), 450);
  }, 2800);
</script>
  <!-- ğŸ”» Dark/Light Theme Packï¼ˆpaste above </body>ï¼‰ -->
<style>
  /* 1) é è¨­èµ°æ·±è‰²ï¼ˆä½ ç¾æœ‰çš„è®Šæ•¸ä¸å‹•ï¼‰ */
  :root{
    /* åªè¦†è“‹æœƒå½±éŸ¿è§€æ„Ÿçš„å¹¾å€‹ tokenï¼›æ²’åˆ—åˆ°çš„æ²¿ç”¨ä½ ç¾æœ‰ */
    --bg:#0e0e10; --card:#141417; --hover:#1a1a1f; --border:rgba(0,0,0,.22);
    --text:#0e0f12; --sub:#4b4c52; --muted:#666a73; --accent:#ff2d55; --accent-2:#ff335a;
  }
  /* 2) æ·ºè‰²ä¸»é¡Œï¼šæ›åœ¨ <html class="theme-light"> æ™‚ç”Ÿæ•ˆ */
  html.theme-light {
    --bg:#fafafa; --card:#ffffff; --hover:#f4f5f7; --border:rgba(0,0,0,.08);
    --text:#121317; --sub:#5b5e66; --muted:#7a7f87;
    --accent:#ff2d55; --accent-2:#ff335a;
  }
  /* 3) ç³»çµ±åå¥½ï¼šè‹¥ä½¿ç”¨è€…æ²’æ‰‹å‹•é¸ï¼Œè·Ÿéš¨ç³»çµ± */
  @media (prefers-color-scheme: light){
    html:not(.theme-dark):not(.theme-light){
      --bg:#fafafa; --card:#ffffff; --hover:#f4f5f7; --border:rgba(0,0,0,.08);
      --text:#121317; --sub:#5b5e66; --muted:#7a7f87;
    }
  }
  /* 4) å°æŒ‰éˆ•æ¨£å¼ï¼ˆè‡ªå‹•æ’åˆ° #friendsHeader å³ä¸Šè§’ï¼‰ */
  .theme-toggle{
    display:inline-flex; align-items:center; justify-content:center;
    width:36px; height:36px; border-radius:12px; border:1px solid var(--border);
    background:var(--card); color:var(--text); font-size:16px;
  }
</style>

<script>
  (function(){
    const KEY='nx_theme';
    const root=document.documentElement;

    // A) å¥—ç”¨å·²å­˜åå¥½æˆ–è·Ÿéš¨ç³»çµ±
    const saved=localStorage.getItem(KEY);
    if(saved==='light'){ root.classList.add('theme-light'); }
    if(saved==='dark'){  root.classList.add('theme-dark'); }

    // B) åœ¨ Friends Header å‹•æ…‹åŠ æŒ‰éˆ•ï¼ˆç„¡éœ€æ”¹ HTMLï¼‰
    function injectBtn(){
      const header=document.getElementById('friendsHeader');
      if(!header || header.querySelector('.theme-toggle')) return;
      const btn=document.createElement('button');
      btn.className='theme-toggle';
      btn.title='åˆ‡æ›æ·±/æ·ºè‰²';
      const syncIcon=()=>{ btn.textContent = root.classList.contains('theme-light') ? 'ğŸŒ™' : 'â˜€ï¸'; };
      btn.onclick=()=>{
        if(root.classList.contains('theme-light')){
          root.classList.remove('theme-light'); root.classList.add('theme-dark');
          localStorage.setItem(KEY,'dark');
        }else if(root.classList.contains('theme-dark')){
          root.classList.remove('theme-dark'); localStorage.removeItem(KEY); // å›åˆ°è·Ÿéš¨ç³»çµ±
        }else{
          root.classList.add('theme-light'); localStorage.setItem(KEY,'light');
        }
        syncIcon();
      };
      syncIcon();
      // æ”¾åˆ° header å³å´
      header.appendChild(btn);
    }

    // C) åˆæ¬¡èˆ‡æ¯æ¬¡åˆ‡åˆ°é¦–é æ™‚éƒ½ç¢ºä¿æœ‰æŒ‰éˆ•
    injectBtn();
    const _showPage = window.showPage;
    if(typeof _showPage === 'function'){
      window.showPage = function(id){ _showPage(id); if(id==='home') injectBtn(); };
    }
  })();
</script>
<!-- ğŸ”º Theme Pack end -->
  <style id="nx-hotfix-colors">
  /* å¼·åˆ¶æ­£ç¢ºçš„æ·±/æ·ºè‰²ä¸»é¡Œè®Šæ•¸ï¼ˆè¦†è“‹æœ€å¾Œé‚£åŒ…æäº‚çš„ï¼‰ */
  :root[data-theme="dark"]{
    --bg:#0e0e10; --card:#141417; --hover:#1a1a1f; --border:rgba(255,255,255,.06);
    --text:#f5f5f5; --sub:#a1a1aa; --muted:#777781;
    --accent:#ff2d55; --accent-2:#ff335a;
  }
  :root[data-theme="light"]{
    --bg:#fafafa; --card:#ffffff; --hover:#f5f6f8; --border:rgba(0,0,0,.08);
    --text:#111114; --sub:#3b3b44; --muted:#7a7a86;
    --accent:#ff2d55; --accent-2:#ff335a;
  }
  /* æŠŠæ–‡å­—é¡è‰²ç¢ºå¯¦å¥—åˆ°å¸¸è¦‹å®¹å™¨ï¼ˆè§£â€œæ·±è‰²è®Šé»‘å­—â€ï¼‰ */
  html, body, section, nav, .card, .friendCard, .bubble, .pill, .topbar,
  .live-stage, .live-hero, .live-feed, .textbox, input, textarea, button,
  .tabs button, .date-chip { color: var(--text) !important; }

  /* èƒŒæ™¯å› IG é¢¨ */
  html,body{
    background:
      radial-gradient(1200px 800px at 90% -10%, rgba(255,45,85,.08), transparent 50%),
      radial-gradient(900px 700px at 10% 110%, rgba(109,40,217,.08), transparent 50%),
      var(--bg) !important;
  }
</style>
</body>
</html>
