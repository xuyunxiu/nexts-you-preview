<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEXT'S YOU — Preview</title>

  <!-- 🚫 防快取 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }
    section { display: none; padding: 20px; }
    section.active { display: block; }
    nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #222; display: flex; justify-content: space-around;
      padding: 10px 0;
    }
    nav.hidden { display: none; }
    nav button {
      background: none; border: none; color: #fff; font-size: 16px;
    }
    .btn {
      display: inline-block; padding: 10px 20px; margin: 10px;
      border-radius: 6px; font-size: 16px; cursor: pointer;
    }
    .btn-red { background: red; color: #fff; }
    input { padding: 8px; border-radius: 4px; border: none; margin: 5px; }

    /* 個人區塊 */
    #friendsHeader {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px; background:#1a1a1a; border-radius:8px; margin-bottom:10px;
    }
    #friendsHeader img {
      width:40px; height:40px; border-radius:50%; cursor:pointer;
    }
    #friendsHeader span {
      cursor:pointer; font-weight:bold;
    }

    /* Friends 分頁 */
    .tabs { display:flex; justify-content:space-around; margin-bottom:10px; }
    .tabs button {
      flex:1; padding:10px; border:none; background:#333; color:#fff;
      cursor:pointer; font-weight:bold;
    }
    .tabs button.active { background:red; }
    .friendList div {
      background:#1f1f1f; margin:5px; padding:10px; border-radius:6px;
    }
  </style>
</head>
<body>
  <!-- 🔐 登入頁 -->
  <section id="login" class="active">
    <h2>登入</h2>
    <button class="btn btn-red" onclick="login('line')">用 LINE 登入（模擬）</button>
    <br>
    <input type="text" id="inviteCode" placeholder="輸入邀請碼，例如 NEXT2025">
    <button class="btn" onclick="login('code')">使用邀請碼</button>
  </section>

  <!-- 🏠 Friends 首頁 -->
  <section id="home">
    <div id="friendsHeader">
      <div style="display:flex;align-items:center;gap:10px;">
        <img id="userAvatar" src="https://via.placeholder.com/40" alt="頭貼" onclick="openProfile()">
        <span id="nickname" onclick="openProfile()">暱稱</span>
      </div>
    </div>

    <div class="tabs">
      <button onclick="switchTab('artist')" id="tab-artist" class="active">藝人</button>
      <button onclick="switchTab('group')" id="tab-group">團體</button>
      <button onclick="switchTab('purchased')" id="tab-purchased">已購買</button>
      <button onclick="switchTab('notpurchased')" id="tab-notpurchased">未購買</button>
    </div>
    <div class="friendList" id="friendList"></div>
  </section>

  <!-- 👤 個人頁 -->
  <section id="profile">
    <h2>我的個人頁</h2>
    <div>
      <img id="editAvatar" src="https://via.placeholder.com/80" style="width:80px;height:80px;border-radius:50%;">
      <br>
      <input type="file" id="avatarInput" accept="image/*" onchange="changeAvatar(event)">
    </div>
    <div>
      <input type="text" id="editNickname" placeholder="輸入暱稱">
      <button onclick="saveProfile()">儲存</button>
    </div>
    <p><strong>粉絲 ID：</strong><span id="fanId"></span></p>
    <button onclick="showPage('home')">返回 Friends</button>
  </section>

  <!-- 底部導覽 -->
  <nav id="nav" class="hidden">
    <button onclick="showPage('home')">首頁</button>
    <button onclick="showPage('dm')">DM</button>
    <button onclick="showPage('gallery')">相簿</button>
    <button onclick="showPage('live')">直播</button>
  </nav>

  <script>
    // 假資料
    const artists = [
      { id:"a1", name:"藝人 A", purchased:true },
      { id:"a2", name:"藝人 B", purchased:false }
    ];
    const groups = [
      { id:"g1", name:"團體 1", purchased:true },
      { id:"g2", name:"團體 2", purchased:false }
    ];

    // --- 假的初始登入 ---
    function login(method) {
      if (method === 'line' || (method === 'code' && document.getElementById('inviteCode').value.trim() === 'NEXT2025')) {
        localStorage.setItem('loggedIn', 'true');
        if (!localStorage.getItem('fanId')) {
          localStorage.setItem('fanId', 'FAN' + Math.floor(Math.random()*100000));
        }
        showPage('home');
      } else {
        alert('邀請碼錯誤！');
      }
    }

    // --- 切換頁面 (自動刷新) ---
    function showPage(page) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      const nav = document.getElementById('nav');
      if (localStorage.getItem('loggedIn') && page !== 'login') {
        nav.classList.remove('hidden');
      } else {
        nav.classList.add('hidden');
      }
      // 每次切換都刷新
      if (page === 'home') {
        renderProfile();
        switchTab('artist');
      }
      if (page === 'profile') {
        document.getElementById('editNickname').value = localStorage.getItem('nickname') || '暱稱';
        document.getElementById('editAvatar').src = localStorage.getItem('avatar') || 'https://via.placeholder.com/80';
        document.getElementById('fanId').textContent = localStorage.getItem('fanId');
      }
    }

    // --- Friends 分頁 ---
    function switchTab(tab) {
      document.querySelectorAll('.tabs button').forEach(btn=>btn.classList.remove('active'));
      document.getElementById('tab-'+tab).classList.add('active');
      const list = document.getElementById('friendList');
      list.innerHTML = "";
      if (tab === 'artist') {
        artists.forEach(a => list.innerHTML += `<div>${a.name} ${a.purchased?"✅":"❌"}</div>`);
      }
      if (tab === 'group') {
        groups.forEach(g => list.innerHTML += `<div>${g.name} ${g.purchased?"✅":"❌"}</div>`);
      }
      if (tab === 'purchased') {
        [...artists,...groups].filter(x=>x.purchased).forEach(x=> list.innerHTML += `<div>${x.name} ✅</div>`);
      }
      if (tab === 'notpurchased') {
        [...artists,...groups].filter(x=>!x.purchased).forEach(x=> list.innerHTML += `<div>${x.name} ❌</div>`);
      }
    }

    // --- 個人頁 ---
    function openProfile(){ showPage('profile'); }
    function saveProfile() {
      const newNick = document.getElementById('editNickname').value.trim();
      if (newNick) localStorage.setItem('nickname', newNick);
      document.getElementById('nickname').textContent = newNick || '暱稱';
      localStorage.setItem('avatar', document.getElementById('editAvatar').src);
      showPage('home');
    }
    function changeAvatar(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById('editAvatar').src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }
    function renderProfile() {
      document.getElementById('nickname').textContent = localStorage.getItem('nickname') || '暱稱';
      document.getElementById('userAvatar').src = localStorage.getItem('avatar') || 'https://via.placeholder.com/40';
    }

    // --- 預設 ---
    window.onload = () => {
      if (localStorage.getItem('loggedIn')) {
        showPage('home');
      } else {
        showPage('login');
      }
    };
  </script>
</body>
</html>
