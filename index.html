<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEXT'S YOU â€” Preview</title>

  <!-- ğŸš« é˜²å¿«å– -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }
    section { display: none; padding: 20px; }
    section.active { display: block; }
    nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #222; display: flex; justify-content: space-around;
      padding: 10px 0;
    }
    nav.hidden { display: none; }
    nav button {
      background: none; border: none; color: #fff; font-size: 16px;
    }
    .btn {
      display: inline-block; padding: 10px 20px; margin: 10px;
      border-radius: 6px; font-size: 16px; cursor: pointer;
    }
    .btn-red { background: red; color: #fff; }
    input { padding: 8px; border-radius: 4px; border: none; margin: 5px; }

    /* å€‹äººå€å¡Š */
    #friendsHeader {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px; background:#1a1a1a; border-radius:8px; margin-bottom:10px;
    }
    #friendsHeader img {
      width:40px; height:40px; border-radius:50%; cursor:pointer;
    }
    #friendsHeader span {
      cursor:pointer; font-weight:bold;
    }

    /* Friends åˆ†é  */
    .tabs { display:flex; justify-content:space-around; margin-bottom:10px; }
    .tabs button {
      flex:1; padding:10px; border:none; background:#333; color:#fff;
      cursor:pointer; font-weight:bold;
    }
    .tabs button.active { background:red; }
    .friendList div {
      background:#1f1f1f; margin:5px; padding:10px; border-radius:6px;
    }
  </style>
</head>
<body>
  <!-- ğŸ” ç™»å…¥é  -->
  <section id="login" class="active">
    <h2>ç™»å…¥</h2>
    <button class="btn btn-red" onclick="login('line')">ç”¨ LINE ç™»å…¥ï¼ˆæ¨¡æ“¬ï¼‰</button>
    <br>
    <input type="text" id="inviteCode" placeholder="è¼¸å…¥é‚€è«‹ç¢¼ï¼Œä¾‹å¦‚ NEXT2025">
    <button class="btn" onclick="login('code')">ä½¿ç”¨é‚€è«‹ç¢¼</button>
  </section>

  <!-- ğŸ  Friends é¦–é  -->
  <section id="home">
    <div id="friendsHeader">
      <div style="display:flex;align-items:center;gap:10px;">
        <img id="userAvatar" src="https://via.placeholder.com/40" alt="é ­è²¼" onclick="openProfile()">
        <span id="nickname" onclick="openProfile()">æš±ç¨±</span>
      </div>
    </div>

    <div class="tabs">
      <button onclick="switchTab('artist')" id="tab-artist" class="active">è—äºº</button>
      <button onclick="switchTab('group')" id="tab-group">åœ˜é«”</button>
      <button onclick="switchTab('purchased')" id="tab-purchased">å·²è³¼è²·</button>
      <button onclick="switchTab('notpurchased')" id="tab-notpurchased">æœªè³¼è²·</button>
    </div>
    <div class="friendList" id="friendList"></div>
  </section>

  <!-- ğŸ‘¤ å€‹äººé  -->
  <section id="profile">
    <h2>æˆ‘çš„å€‹äººé </h2>
    <div>
      <img id="editAvatar" src="https://via.placeholder.com/80" style="width:80px;height:80px;border-radius:50%;">
      <br>
      <input type="file" id="avatarInput" accept="image/*" onchange="changeAvatar(event)">
    </div>
    <div>
      <input type="text" id="editNickname" placeholder="è¼¸å…¥æš±ç¨±">
      <button onclick="saveProfile()">å„²å­˜</button>
    </div>
    <p><strong>ç²‰çµ² IDï¼š</strong><span id="fanId"></span></p>
    <button onclick="showPage('home')">è¿”å› Friends</button>
  </section>

  <!-- åº•éƒ¨å°è¦½ -->
  <nav id="nav" class="hidden">
    <button onclick="showPage('home')">é¦–é </button>
    <button onclick="showPage('dm')">DM</button>
    <button onclick="showPage('gallery')">ç›¸ç°¿</button>
    <button onclick="showPage('live')">ç›´æ’­</button>
  </nav>

  <script>
    // å‡è³‡æ–™
    const artists = [
      { id:"a1", name:"è—äºº A", purchased:true },
      { id:"a2", name:"è—äºº B", purchased:false }
    ];
    const groups = [
      { id:"g1", name:"åœ˜é«” 1", purchased:true },
      { id:"g2", name:"åœ˜é«” 2", purchased:false }
    ];

    // --- å‡çš„åˆå§‹ç™»å…¥ ---
    function login(method) {
      if (method === 'line' || (method === 'code' && document.getElementById('inviteCode').value.trim() === 'NEXT2025')) {
        localStorage.setItem('loggedIn', 'true');
        if (!localStorage.getItem('fanId')) {
          localStorage.setItem('fanId', 'FAN' + Math.floor(Math.random()*100000));
        }
        showPage('home');
      } else {
        alert('é‚€è«‹ç¢¼éŒ¯èª¤ï¼');
      }
    }

    // --- åˆ‡æ›é é¢ (è‡ªå‹•åˆ·æ–°) ---
    function showPage(page) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      const nav = document.getElementById('nav');
      if (localStorage.getItem('loggedIn') && page !== 'login') {
        nav.classList.remove('hidden');
      } else {
        nav.classList.add('hidden');
      }
      // æ¯æ¬¡åˆ‡æ›éƒ½åˆ·æ–°
      if (page === 'home') {
        renderProfile();
        switchTab('artist');
      }
      if (page === 'profile') {
        document.getElementById('editNickname').value = localStorage.getItem('nickname') || 'æš±ç¨±';
        document.getElementById('editAvatar').src = localStorage.getItem('avatar') || 'https://via.placeholder.com/80';
        document.getElementById('fanId').textContent = localStorage.getItem('fanId');
      }
    }

    // --- Friends åˆ†é  ---
    function switchTab(tab) {
      document.querySelectorAll('.tabs button').forEach(btn=>btn.classList.remove('active'));
      document.getElementById('tab-'+tab).classList.add('active');
      const list = document.getElementById('friendList');
      list.innerHTML = "";
      if (tab === 'artist') {
        artists.forEach(a => list.innerHTML += `<div>${a.name} ${a.purchased?"âœ…":"âŒ"}</div>`);
      }
      if (tab === 'group') {
        groups.forEach(g => list.innerHTML += `<div>${g.name} ${g.purchased?"âœ…":"âŒ"}</div>`);
      }
      if (tab === 'purchased') {
        [...artists,...groups].filter(x=>x.purchased).forEach(x=> list.innerHTML += `<div>${x.name} âœ…</div>`);
      }
      if (tab === 'notpurchased') {
        [...artists,...groups].filter(x=>!x.purchased).forEach(x=> list.innerHTML += `<div>${x.name} âŒ</div>`);
      }
    }

    // --- å€‹äººé  ---
    function openProfile(){ showPage('profile'); }
    function saveProfile() {
      const newNick = document.getElementById('editNickname').value.trim();
      if (newNick) localStorage.setItem('nickname', newNick);
      document.getElementById('nickname').textContent = newNick || 'æš±ç¨±';
      localStorage.setItem('avatar', document.getElementById('editAvatar').src);
      showPage('home');
    }
    function changeAvatar(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById('editAvatar').src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }
    function renderProfile() {
      document.getElementById('nickname').textContent = localStorage.getItem('nickname') || 'æš±ç¨±';
      document.getElementById('userAvatar').src = localStorage.getItem('avatar') || 'https://via.placeholder.com/40';
    }

    // --- é è¨­ ---
    window.onload = () => {
      if (localStorage.getItem('loggedIn')) {
        showPage('home');
      } else {
        showPage('login');
      }
    };
  </script>
</body>
</html>
