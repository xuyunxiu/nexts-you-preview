<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEXT'S YOU — Preview</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }
    section { display: none; padding: 20px; }
    section.active { display: block; }
    nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #222; display: flex; justify-content: space-around;
      padding: 10px 0;
    }
    nav.hidden { display: none; }
    nav button {
      background: none; border: none; color: #fff; font-size: 16px;
    }
    .btn {
      display: inline-block; padding: 10px 20px; margin: 10px;
      border-radius: 6px; font-size: 16px; cursor: pointer;
    }
    .btn-red { background: red; color: #fff; }
    input { padding: 8px; border-radius: 4px; border: none; margin: 5px; }
    .topbar {
      display: flex; justify-content: space-between; align-items: center;
    }
    .hearts {
      font-size: 18px; color: pink;
    }
    .product {
      background: #222; margin: 10px; padding: 15px; border-radius: 8px;
    }
  </style>
</head>
<body>
  <!-- 登入頁 -->
  <section id="login" class="active">
    <h2>登入</h2>
    <button class="btn btn-red" onclick="login('line')">用 LINE 登入（模擬）</button>
    <br>
    <input type="text" id="inviteCode" placeholder="輸入邀請碼，例如 NEXT2025">
    <button class="btn" onclick="login('code')">使用邀請碼</button>
  </section>

  <!-- 首頁 -->
  <section id="home">
    <div class="topbar">
      <h2>首頁</h2>
    </div>
    <p>這裡是首頁內容！</p>
    <p><strong>我的分數：</strong><span id="points">0</span></p>
    <h3>商品區</h3>
    <div class="product">
      <p>7天 DM 權益 — 70 分</p>
      <button onclick="buyProduct(70,7)">購買</button>
    </div>
    <div class="product">
      <p>30天 DM 權益 — 250 分</p>
      <button onclick="buyProduct(250,30)">購買</button>
    </div>
  </section>

  <!-- DM -->
  <section id="dm">
    <div class="topbar">
      <h2>DM</h2>
      <div class="hearts">♡<span id="heartDays">0</span></div>
    </div>
    <p>這裡會顯示聊天記錄。</p>
  </section>

  <!-- 相簿 -->
  <section id="gallery">
    <h2>相簿</h2>
    <p>藝人上傳的圖片會顯示在這裡。</p>
  </section>

  <!-- 直播 -->
  <section id="live">
    <h2>直播</h2>
    <p>文字直播或影片牆。</p>
  </section>

  <!-- 底部導覽 -->
  <nav id="nav" class="hidden">
    <button onclick="showPage('home')">首頁</button>
    <button onclick="showPage('dm')">DM</button>
    <button onclick="showPage('gallery')">相簿</button>
    <button onclick="showPage('live')">直播</button>
  </nav>

  <script>
    // --- 假的初始分數 (測試用)，之後你們後台會去改 ---
    if (!localStorage.getItem('points')) {
      localStorage.setItem('points', 200); // 預設200分
    }

    // --- 登入 ---
    function login(method) {
      if (method === 'line' || (method === 'code' && document.getElementById('inviteCode').value.trim() === 'NEXT2025')) {
        localStorage.setItem('loggedIn', 'true');
        showPage('home');
        renderPoints();
      } else {
        alert('邀請碼錯誤！');
      }
    }

    // --- 切換頁面 ---
    function showPage(page) {
      if (!localStorage.getItem('loggedIn') && page !== 'login') {
        page = 'login';
      }
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      const nav = document.getElementById('nav');
      if (localStorage.getItem('loggedIn') && page !== 'login') {
        nav.classList.remove('hidden');
      } else {
        nav.classList.add('hidden');
      }
      if (page === 'home') renderPoints();
      if (page === 'dm') renderHearts();
    }

    // --- 分數顯示 ---
    function renderPoints() {
      document.getElementById('points').textContent = localStorage.getItem('points');
    }

    // --- 購買商品 ---
    function buyProduct(cost, days) {
      let points = parseInt(localStorage.getItem('points'));
      if (points >= cost) {
        points -= cost;
        localStorage.setItem('points', points);
        localStorage.setItem('purchaseDate', new Date().toISOString().split('T')[0]);
        localStorage.setItem('duration', days);
        alert(`✅ 已購買 ${days} 天 DM 權益！`);
        renderPoints();
      } else {
        alert('分數不足！');
      }
    }

    // --- Hearts (♡+N) ---
    function daysSince(dateStr) {
      if (!dateStr) return 0;
      const start = new Date(dateStr);
      const today = new Date();
      start.setHours(0,0,0,0);
      today.setHours(0,0,0,0);
      return Math.floor((today - start) / 86400000);
    }

    function renderHearts() {
      const start = localStorage.getItem('purchaseDate');
      const duration = parseInt(localStorage.getItem('duration') || 0);
      if (!start) {
        document.getElementById('heartDays').textContent = "0";
        return;
      }
      const n = daysSince(start);
      if (n <= duration) {
        document.getElementById('heartDays').textContent = n;
      } else {
        document.getElementById('heartDays').textContent = "0"; // 過期了
      }
    }

    // --- 預設 ---
    window.onload = () => {
      if (localStorage.getItem('loggedIn')) {
        showPage('home');
      } else {
        showPage('login');
      }
    };
  </script>
</body>
</html>
