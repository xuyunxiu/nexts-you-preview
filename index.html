<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>NEXT'S YOU â€” App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    /* ===== Theme ===== */
    body.nx{
      --bg:#0f0f12; --card:#16181d; --hover:#1b1e24; --line:rgba(255,255,255,.06);
      --text:#f6f7fb; --sub:#b5bac7; --muted:#8c92a1;
      --accent:#ff2d55; --accent-2:#ff3b63; --ok:#2ecc71; --ng:#ff5a5f;
      --r:16px; --shadow: 12px 18px 40px rgba(0,0,0,.45);
      margin:0; color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .panel,.card,.product{background:var(--card); border:1px solid var(--line); border-radius:var(--r); box-shadow:var(--shadow)}
    .panel.soft{padding:16px}

    /* ===== Sections ===== */
    section{display:none; padding:16px 16px 96px}
    section.active{display:block; animation:fadeIn .24s ease}
    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
    h2,h3,p{margin:0}
    .ghost{opacity:.75; color:var(--sub)}
    .list-col{display:grid; gap:12px}

    /* ===== Home header ===== */
    #friendsHeader{display:flex; justify-content:space-between; align-items:center; gap:12px}
    #friendsHeader .me{display:flex; align-items:center; gap:12px}
    #friendsHeader img{width:48px; height:48px; border-radius:50%; object-fit:cover; border:1px solid var(--line)}
    #friendsHeader .nick{font-weight:800}

#nav, #storyBar {
  transition: transform 0.3s ease;
}
    
   /* ===== Story bar ===== */
.story-bar {
  display: flex;
  gap: 14px;   /* é–“è· */
  padding: 12px;
  overflow-x: auto;
}

.story-item {
  flex: 0 0 auto;
  text-align: center;
  cursor: pointer;
}

.story-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid orange;
  object-fit: cover;
}

.story-name {
  margin-top: 4px;
  font-size: 12px;
  color: var(--sub);
}
   
    /* ===== Tabs ===== */
    .tabs{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin:14px 0}
    .tabs button{
      border:none; border-radius:999px; padding:10px 0; font-weight:800; color:var(--sub);
      background:var(--card); border:1px solid var(--line); box-shadow:var(--shadow); cursor:pointer;
    }
    .tabs button.active{ color:var(--text); background:linear-gradient(180deg, var(--hover), var(--card)); border-color:transparent }

    /* ===== Cards ===== */
    .card .row{display:flex; align-items:center; gap:12px}
    .card .row img{width:52px; height:52px; border-radius:50%; object-fit:cover; border:1px solid var(--line)}

    /* ===== DM ===== */
    .topbar{display:flex; align-items:center; gap:12px; margin-bottom:10px}
    .dm-title{font-weight:800}
    .menu-btn{width:40px; height:40px; border-radius:12px; border:1px solid var(--line); background:var(--card); color:var(--text); cursor:pointer}
    .dm-messages{display:flex; flex-direction:column; gap:14px; max-height:62vh; overflow:auto; padding-bottom:6px}
    .msg{max-width:78%; position:relative; padding:12px 14px; border-radius:18px; border:1px solid var(--line); background:linear-gradient(180deg,#fff,#f2f3f5); color:#17181c}
    .msg.me{margin-left:auto; background:linear-gradient(180deg, var(--hover), #121317); color:#e8eaf0}
    .date-chip{align-self:center; border:1px solid var(--line); border-radius:999px; padding:6px 12px; color:var(--sub); background:var(--hover); font-weight:800; font-size:12px}
    .msg time{position:absolute; right:14px; bottom:-18px; font-size:11px; color:var(--muted)}
    .dm-input{position:fixed; left:0; right:0; bottom:0; padding:12px 14px; background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.55)); backdrop-filter:blur(10px); display:flex; gap:10px}
    .dm-input input{flex:1; border:none; outline:none; border-radius:16px; padding:14px 16px; background:var(--hover); color:var(--text); border:1px solid var(--line)}
    .dm-input button{width:52px; height:52px; border:none; border-radius:18px; font-weight:900; color:#fff; background:linear-gradient(180deg,var(--accent),var(--accent-2)); cursor:pointer}

    /* ===== GALLERY ===== */
    #galleryGrid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    #galleryGrid img{width:100%; height:100%; object-fit:cover; border-radius:14px; border:1px solid var(--line); box-shadow:var(--shadow)}

    /* ===== LIVE ===== */
    .live-card {display:flex; align-items:center; padding:10px; border-bottom:1px solid var(--line); cursor:pointer;}
    .live-card img {width:100px; height:60px; border-radius:8px; object-fit:cover; margin-right:10px;}
    .host-card {padding:12px; border-bottom:1px solid var(--line); background:var(--card);}
    .host-card .row {display:flex; align-items:center; gap:10px;}
    .host-card img {width:48px; height:48px; border-radius:50%;}
    #fanMessages {height:50vh; overflow-y:auto; padding:10px; background:var(--bg);}
    #fanInput {display:flex; border-top:1px solid var(--line); padding:8px; background:var(--bg);}
    #fanMsgInput {flex:1; border:1px solid var(--line); border-radius:12px; padding:8px 12px;}
    #fanInput button {margin-left:8px; padding:8px 14px; border:none; border-radius:12px; background:linear-gradient(180deg, var(--accent), var(--accent-2)); color:#fff; cursor:pointer;}

    /* ===== NAV ===== */
    nav{position:fixed; left:0; right:0; bottom:0; background:#0f1116; border-top:1px solid var(--line);
      display:flex; justify-content:space-around; padding:12px 8px 16px; backdrop-filter:blur(8px)}
    nav.hidden{display:none}
    nav button{background:transparent; border:none; color:var(--text); font-weight:800; padding:8px 10px; border-radius:12px; cursor:pointer}
    nav button:active{background:var(--hover)}

/* Profile */
#profileBgWrap {
  position: relative;
  width: 100%;
  height: 100vh; /* æ»¿ç‰ˆèƒŒæ™¯ */
  overflow: hidden;
}
#profileBg {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
}
#profileAvatarWrap {
  position: absolute;
  bottom: -48px;
  left: 50%;
  transform: translateX(-50%);
}
#editAvatar {
  width: 96px;
  height: 96px;
  border-radius: 50%;
  border: 3px solid #fff;
  object-fit: cover;
  cursor: pointer;
}
#profileInfo {
  margin-top: 60px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.profile-item {
  background: var(--card);
  border-radius: 12px;
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.profile-item .label {
  color: var(--sub);
  font-size: 13px;
}
.profile-item .value {
  font-weight: 600;
  color: var(--text);
}
.edit-btn {
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 14px;
}
</style>
</head>
<body class="nx">

<!-- ===== HOME ===== -->
<section id="home" class="active">
  <div id="friendsHeader">
    <div class="me" onclick="openProfile()">
      <img id="avatar" src="https://picsum.photos/80?u=me">
      <div class="nick" id="nickname">æš±ç¨±</div>
    </div>
    <!-- å³é‚Šå¯æ”¾é€šçŸ¥ / è¨­å®šæŒ‰éˆ• -->
  </div>

  <div id="storyBar" class="story-bar"></div>
  <div id="feedWrap" class="feed-col"></div>
</section>

<!-- ===== POST DETAILï¼ˆç•™è¨€å€é é¢ï¼‰ ===== -->
<section id="postDetail">
  <div class="topbar">
    <button class="menu-btn" onclick="showPage('home')">â†</button>
    <h2>ç•™è¨€å€</h2>
    <button id="translateBtn" class="menu-btn" onclick="translatePost()">ç¿»è­¯</button>
  </div>

  <!-- è²¼æ–‡å…§å®¹ -->
  <div id="postDetailContent"></div>

  <!-- åªçœ‹è—äººå›è¦† -->
  <div style="padding:12px">
    <label>
      <input type="checkbox" id="filterArtist" onchange="renderComments()"> åªçœ‹è—äººå›è¦†
    </label>
  </div>

  <!-- ç•™è¨€åˆ—è¡¨ -->
  <div id="commentList" style="padding:12px"></div>

  <!-- ç•™è¨€è¼¸å…¥ -->
  <div class="dm-input">
    <input id="commentInput" placeholder="è¼¸å…¥è©•è«–â€¦" />
    <button onclick="sendComment()">é€å‡º</button>
  </div>
</section>
  
<!-- ===== DM åˆ—è¡¨ ===== -->
<section id="dmList">
  <div class="topbar"><h2>DM åˆ—è¡¨</h2></div>
  <div id="dmListWrap"></div>
  <div id="dmListEmpty" class="ghost">å°šæœªè³¼è²· PASS</div>
</section>

<!-- ===== DM èŠå¤©å®¤ ===== -->
<section id="dm">
  <div class="topbar">
    <button class="menu-btn" onclick="showPage('dmList')">â†</button>
    <h2 id="dmTitle">DM</h2>
  </div>
  <div id="dm-messages" class="dm-messages"></div>
  <div class="dm-input">
    <input id="dmInput" placeholder="è¼¸å…¥è¨Šæ¯â€¦" />
    <button onclick="sendMessage()">é€å‡º</button>
  </div>
</section>

<!-- ===== PROFILE ===== -->
<section id="profile">
  <div class="topbar">
    <button class="menu-btn" onclick="goBack()">â†</button>
    <h2>å€‹äººè³‡æ–™</h2>
  </div>

  <div id="profileBgWrap">
    <img id="profileBg" src="https://picsum.photos/600/400?blur" onclick="document.getElementById('bgInput').click()">
    <input type="file" id="bgInput" accept="image/*" class="onlyMe" style="display:none" onchange="changeBg(event)">
    <div id="profileAvatarWrap">
      <img id="editAvatar" src="https://picsum.photos/160?u=me" onclick="document.getElementById('avatarInput').click()">
      <input type="file" id="avatarInput" accept="image/*" class="onlyMe" style="display:none" onchange="changeAvatar(event)">
    </div>
  </div>

  <div id="profileInfo">
    <div class="profile-item">
      <span class="label">æš±ç¨±</span>
      <span class="value" id="nickname">æš±ç¨±</span>
      <button class="edit-btn onlyMe" onclick="editNickname()">âœï¸</button>
    </div>
    <div class="profile-item">
      <span class="label">ç‹€æ…‹è¨Šæ¯</span>
      <span class="value" id="statusMsg">å°šæœªè¨­å®š</span>
      <button class="edit-btn onlyMe" onclick="editStatus()">âœï¸</button>
    </div>
    <div class="profile-item">
      <span class="label">ç²‰çµ² ID</span>
      <span class="value" id="fanId"></span>
    </div>
    <div class="profile-item">
      <span class="label">åŠ å…¥æ—¥æœŸ</span>
      <span class="value" id="joinDate"></span>
    </div>
  </div>
</section>

<!-- ===== GALLERY ===== -->
<section id="gallery">
  <div class="topbar"><h2>ç›¸ç°¿</h2></div>
  <div id="galleryGrid"></div>
</section>

<!-- ===== LIVE LIST ===== -->
<section id="liveList">
  <div class="topbar"><h2>ç›´æ’­åˆ—è¡¨</h2><button onclick="toggleLiveSort()">æ’åº</button></div>
  <div id="liveListWrap"></div>
</section>

<!-- ===== LIVE DETAIL ===== -->
<section id="liveDetail">
  <div class="topbar"><button class="menu-btn" onclick="showPage('liveList')">â†</button><h2 id="liveTitle">ç›´æ’­ä¸­</h2></div>
  <div id="hostInfo" class="host-card"></div>
  <div id="fanMessages"></div>
  <div id="fanInput"><input id="fanMsgInput" placeholder="è¼¸å…¥ç•™è¨€â€¦"><button onclick="sendFanMsg()">é€å‡º</button></div>
</section>

<!-- ===== WALLET ===== -->
<section id="wallet">
  <div class="topbar"><h2>éŒ¢åŒ…</h2></div>
  <div class="panel soft"><p>ç›®å‰é»æ•¸ï¼š<b id="points2">0</b></p><button onclick="buyPass()">è³¼è²·åœ˜é«” PASS</button></div>
</section>

<!-- ===== NAV ===== -->
<nav id="nav">
  <button onclick="showPage('home')">é¦–é </button>
  <button onclick="showPage('dmList')">DM</button>
  <button onclick="showPage('liveList')">ç›´æ’­</button>
  <button onclick="showPage('wallet')">éŒ¢åŒ…</button>
</nav>

<script>
/* ===== å…¨åŸŸè³‡æ–™ ===== */
const ARTISTS = [
  {id:'a1', name:'Annie', avatar:'https://picsum.photos/80?u=a1'},
  {id:'a2', name:'Dohee', avatar:'https://picsum.photos/80?u=a2'},
  {id:'a3', name:'Woochan', avatar:'https://picsum.photos/80?u=a3'}
];
const GROUPS = [{id:'group', name:'ALLDAY PROJECT', avatar:'https://picsum.photos/80?u=group'}];
let liveSortDesc = true;

/* ===== NAV & é é¢åˆ‡æ› ===== */
function showPage(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  const target = document.getElementById(id);
  if (target) target.classList.add('active');

  const nav = document.getElementById('nav');
  // é€™å¹¾é è¦éš±è—åº•éƒ¨ nav
  if (['login','dm','gallery','postDetail','profile'].includes(id)) {
    nav.classList.add('hidden');
  } else {
    nav.classList.remove('hidden');
  }
} // â†â†â† é€™å€‹çµå°¾æ‹¬è™Ÿä½ ä¹‹å‰å°‘äº†

function openProfile(){
  showPage('profile');
  loadProfile();
}

// ===== Profile åŠŸèƒ½ =====
function changeAvatar(e){
  const f = e.target.files[0];
  if(f){
    const u = URL.createObjectURL(f);
    document.getElementById('editAvatar').src = u;
    localStorage.setItem('avatar', u);
  }
}
function changeBg(e){
  const f = e.target.files[0];
  if(f){
    const u = URL.createObjectURL(f);
    document.getElementById('profileBg').src = u;
    localStorage.setItem('profileBg', u);
  }
}
function editNickname(){
  const current = localStorage.getItem('nickname') || 'æš±ç¨±';
  const n = prompt("è¼¸å…¥æ–°æš±ç¨±", current);
  if(n){
    localStorage.setItem('nickname', n);
    document.getElementById('nickname').textContent = n;
  }
}
function editStatus(){
  const current = localStorage.getItem('statusMsg') || 'å°šæœªè¨­å®š';
  const s = prompt("è¼¸å…¥ç‹€æ…‹è¨Šæ¯", current);
  if(s){
    localStorage.setItem('statusMsg', s);
    document.getElementById('statusMsg').textContent = s;
  }
}

// è‡ªå‹•ç”¢ç”Ÿç²‰çµ² ID & åŠ å…¥æ—¥æœŸ
function getFanId(){
  let id = localStorage.getItem('fanId');
  if(!id){
    let counter = parseInt(localStorage.getItem('fanCounter')||'0',10) + 1;
    localStorage.setItem('fanCounter', counter);
    id = `NEXT${counter}`;
    localStorage.setItem('fanId', id);
    localStorage.setItem('joinDate', new Date().toLocaleDateString());
  }
  return id;
}
function getMyFanId(){ return localStorage.getItem('fanId') || getFanId(); }

// è¼‰å…¥è‡ªå·± Profile
function loadProfile(){
  document.getElementById('editAvatar').src = localStorage.getItem('avatar') || "default-avatar.png";
  document.getElementById('profileBg').src = localStorage.getItem('profileBg') || "default-bg.jpg";
  document.getElementById('nickname').textContent = localStorage.getItem('nickname') || "æš±ç¨±";
  document.getElementById('statusMsg').textContent = localStorage.getItem('statusMsg') || "å°šæœªè¨­å®š";
  document.getElementById('fanId').textContent = getMyFanId();
  document.getElementById('joinDate').textContent = localStorage.getItem('joinDate') || new Date().toLocaleDateString();
}

// é¡¯ç¤ºç²‰çµ² Profileï¼ˆè‡ªå·± or åˆ¥äººï¼‰
function showFanProfile(fan){
  showPage('profile'); // å…±ç”¨ä¸€å€‹ profile é é¢

  document.getElementById('profileBg').src = fan.bg || 'default-bg.jpg';
  document.getElementById('editAvatar').src = fan.avatar || 'default-avatar.png';
  document.getElementById('nickname').textContent = fan.nickname || 'æš±ç¨±';
  document.getElementById('statusMsg').textContent = fan.status || 'å°šæœªè¨­å®š';
  document.getElementById('fanId').textContent = fan.fanId;
  document.getElementById('joinDate').textContent = fan.joinDate || 'æœªçŸ¥';

  if(fan.fanId === getMyFanId()){
    document.querySelectorAll('.onlyMe').forEach(el=>el.style.display = 'flex');
  }else{
    document.querySelectorAll('.onlyMe').forEach(el=>el.style.display = 'none');
  }
}

/* ===== DM åˆ—è¡¨ï¼ˆè£œé½Šç¼ºçš„å‡½å¼ï¼Œé¿å…å ±éŒ¯ï¼‰ ===== */
// PASSï¼šé è¨­ 30 å¤©æœ‰æ•ˆ
function hasAccess(){
  const d = localStorage.getItem('purchaseDate');
  if (!d) return false;
  const exp = new Date(d);
  exp.setDate(exp.getDate() + 30);
  return Date.now() < exp.getTime();
}

function renderDMList(){
  const box = document.getElementById('dmListWrap');
  const items = [...GROUPS, ...ARTISTS];
  const openItems = items.filter(() => hasAccess());

  if (openItems.length){
    box.innerHTML = openItems.map(it=>`
      <div class="card" onclick="enterDMFromList('${it.id}')">
        <div class="row">
          <img src="${it.avatar}">
          <div><b>${it.name}</b></div>
        </div>
      </div>`).join('');
  } else {
    box.innerHTML = `<p style="text-align:center; margin-top:40px; color:var(--sub)">
      å°šæœªæ“æœ‰è—äººçš„ DM
    </p>`;
  }
}

function enterDMFromList(whoId){
  const who = ARTISTS.find(a=>a.id===whoId) || GROUPS.find(g=>g.id===whoId);
  document.getElementById('dmTitle').textContent = who?.name || 'DM';
  showPage('dm');
}

function buyPass(){
  localStorage.setItem('purchaseDate', new Date().toISOString());
  alert('å·²è³¼è²·åœ˜é«” PASSï¼Œæœ‰æ•ˆæœŸ 30 å¤©');
  renderDMList();
}

// DM ç™¼é€
function sendMessage(){
  const inp = document.getElementById('dmInput');
  const text = (inp.value || '').trim();
  if (!text) return;
  const box = document.getElementById('dm-messages');
  const msg = document.createElement('div');
  msg.className = 'msg me';
  msg.innerHTML = `${text}<time>${new Date().toLocaleTimeString().slice(0,5)}</time>`;
  box.appendChild(msg);
  box.scrollTop = box.scrollHeight;
  inp.value = '';
}

/* ===== Live ===== */
const LIVES = [
  {id:'l1', title:'Annie é–‹æ’­äº†ï¼', host:'Annie', cover:'https://picsum.photos/200?u=l1', ts:Date.now()},
  {id:'l2', title:'Dohee çš„ç›´æ’­', host:'Dohee', cover:'https://picsum.photos/200?u=l2', ts:Date.now()-10000000}
];
function renderLiveList(){
  const wrap = document.getElementById('liveListWrap');
  const sorted = [...LIVES].sort((a,b)=> liveSortDesc ? b.ts - a.ts : a.ts - b.ts);
  wrap.innerHTML = sorted.map(l=>`
    <div class="live-card" onclick="openLive('${l.id}')">
      <img src="${l.cover}">
      <div><b>${l.title}</b><br><small>${l.host}</small></div>
    </div>`).join('');
}
function toggleLiveSort(){ liveSortDesc = !liveSortDesc; renderLiveList(); }
function openLive(id){
  const live = LIVES.find(l=>l.id===id);
  document.getElementById('liveTitle').textContent = live.title;
  document.getElementById('hostInfo').innerHTML =
    `<div class="row"><img src="${live.cover}"><div><div class="name">${live.host}</div><div class="ghost">æ­£åœ¨ç›´æ’­ä¸­</div></div></div>`;
  showPage('liveDetail');
  renderFanMessages();
}
function renderFanMessages(){
  const box = document.getElementById('fanMessages');
  box.innerHTML = '';
  const msgs = JSON.parse(localStorage.getItem('fanMsgs') || '[]');
  msgs.forEach(m=>{
    const wrap = document.createElement('div');
    wrap.className = 'msg';
    wrap.innerHTML = `<img src="https://picsum.photos/40?u=${m.user}"><div class="bubble">${m.text}</div>`;
    box.appendChild(wrap);
  });
}
function sendFanMsg(){
  const inp = document.getElementById('fanMsgInput');
  const t = (inp.value||'').trim();
  if(!t) return;
  const msgs = JSON.parse(localStorage.getItem('fanMsgs')||'[]');
  msgs.push({user:Date.now(),text:t});
  localStorage.setItem('fanMsgs', JSON.stringify(msgs));
  inp.value='';
  renderFanMessages();
}

/* ===== Story Bar + Feed ===== */
const POSTS = [
  {id:1, user:'Woochan', tag:'woo',    avatar:'https://picsum.photos/60?u=wc',    text:'ä»Šå¤©åƒæ‹‰éºµ ğŸœ', img:'https://picsum.photos/500?u=wc1',   ts:'13å°æ™‚å‰'},
  {id:2, user:'Dohee',   tag:'dohee',  avatar:'https://picsum.photos/60?u=dh',    text:'ç·´èˆç·´åˆ°çˆ†æ±— ğŸ’ƒ', img:'https://picsum.photos/500?u=dh1',  ts:'10å°æ™‚å‰'},
  {id:3, user:'Annie',   tag:'annie',  avatar:'https://picsum.photos/60?u=an',    text:'å‚³äº†ä¸€å¼µè‡ªæ‹ ğŸ“¸', img:'https://picsum.photos/500?u=an1',  ts:'8å°æ™‚å‰'},
  {id:4, user:'ALLDAY PROJECT', tag:'allday', avatar:'https://picsum.photos/60?u=group', text:'æ–°å–®æ›²å¿«è¦å…¬é–‹ï¼ğŸ”¥', img:'https://picsum.photos/500?u=group1', ts:'6å°æ™‚å‰'}
];
const STORY_USERS = [
  {id:'all',    name:'ALL',             avatar:'https://picsum.photos/60?u=all'},
  {id:'allday', name:'ALLDAY PROJECT',  avatar:'https://picsum.photos/60?u=group'},
  {id:'woo',    name:'Woochan',         avatar:'https://picsum.photos/60?u=wc'},
  {id:'dohee',  name:'Dohee',           avatar:'https://picsum.photos/60?u=dh'},
  {id:'annie',  name:'Annie',           avatar:'https://picsum.photos/60?u=an'}
];

function renderStoryBar(){
  const bar = document.getElementById('storyBar');
  bar.innerHTML = STORY_USERS.map(u=>`
    <div class="story-item" onclick="renderFeed('${u.id}')">
      <img src="${u.avatar}" class="story-avatar">
      <div class="story-name">${u.name}</div>
    </div>
  `).join('');
}

function renderFeed(filter='all'){
  const wrap = document.getElementById('feedWrap');
  let list = POSTS;
  if (filter!=='all') list = list.filter(p => p.tag === filter);
  wrap.innerHTML = list.map(p=>`
    <div class="card soft" style="margin-bottom:16px; padding:12px" onclick="openPostDetail(${p.id})">
      <div class="row">
        <img src="${p.avatar}">
        <div><b>${p.user}</b><br><small class="ghost">${p.ts}</small></div>
      </div>
      <p style="margin-top:8px">${p.text}</p>
      ${p.img ? `<img src="${p.img}" style="width:100%; border-radius:12px; margin-top:8px">` : ''}
    </div>
  `).join('');
}

function openPostDetail(postId){
  const post = POSTS.find(p => p.id === postId);
  if(!post) return;
  document.getElementById('postDetailContent').innerHTML = `
    <div class="card soft" style="margin-bottom:16px; padding:12px">
      <div class="row">
        <img src="${post.avatar}">
        <div><b>${post.user}</b><br><small class="ghost">${post.ts}</small></div>
      </div>
      <p style="margin-top:8px">${post.text}</p>
      ${post.img ? `<img src="${post.img}" style="width:100%; border-radius:12px; margin-top:8px">` : ''}
    </div>
  `;
  renderComments();
  showPage('postDetail');
}

/* ===== Comments ===== */
let COMMENTS = [
  {id:1, user:'ç²‰çµ²A', isArtist:false, text:'å¥½å¥½è½ï¼'},
  {id:2, user:'Dohee', isArtist:true,  text:'è¬è¬å¤§å®¶ ğŸ’–'},
  {id:3, user:'ç²‰çµ²B', isArtist:false, text:'æœŸå¾…ä¸‹ä¸€é¦–ï¼'},
  {id:4, user:'Annie', isArtist:true,  text:'å¤§å®¶å°å¿ƒèº«é«”ï½'}
];

function renderComments(){
  const box = document.getElementById('commentList');
  const onlyArtist = document.getElementById('filterArtist').checked;
  let list = COMMENTS;
  if (onlyArtist) list = list.filter(c => c.isArtist);
  box.innerHTML = list.map(c=>`
    <div class="card soft" style="margin-bottom:10px; padding:10px">
      <b style="color:${c.isArtist ? 'var(--accent)' : 'var(--text)'}">${c.user}</b>
      <p style="margin:6px 0 0">${c.text}</p>
    </div>
  `).join('');
}

function sendComment(){
  const inp = document.getElementById('commentInput');
  const text = inp.value.trim();
  if(!text) return;
  COMMENTS.push({id: Date.now(), user:'æˆ‘', isArtist:false, text});
  inp.value='';
  renderComments();
}

/* ===== ç¿»è­¯åŠŸèƒ½ï¼ˆç¤ºæ„ï¼‰ ===== */
let isTranslated = false;
let originalText = '';
function translatePost(){
  const contentBox = document.querySelector('#postDetailContent p');
  if(!contentBox) return;
  if(!isTranslated){
    originalText = contentBox.textContent;
    contentBox.textContent = `ï¼ˆå·²ç¿»è­¯ï¼‰${originalText} [ä¸­æ–‡ç¿»è­¯ç‰ˆ]`;
    document.getElementById('translateBtn').textContent = 'é‚„åŸåŸæ–‡';
    isTranslated = true;
  } else {
    contentBox.textContent = originalText;
    document.getElementById('translateBtn').textContent = 'ç¿»è­¯';
    isTranslated = false;
  }
}

// è‡ªå‹•ç”¢ç”Ÿç²‰çµ² ID
function getFanId(){
  let id = localStorage.getItem('fanId');
  if(!id){
    let counter = parseInt(localStorage.getItem('fanCounter')||'0',10) + 1;
    localStorage.setItem('fanCounter', counter);
    id = `NEXT${counter}`;
    localStorage.setItem('fanId', id);
  }
  return id;
}

// ä¿®æ”¹æš±ç¨±
function editNickname(){
  const current = localStorage.getItem('nickname') || 'æš±ç¨±';
  const n = prompt("è¼¸å…¥æ–°æš±ç¨±", current);
  if(n){
    localStorage.setItem('nickname', n);
    document.getElementById('nickname').textContent = n;
  }
}

// ä¿®æ”¹ç‹€æ…‹è¨Šæ¯
function editStatus(){
  const current = localStorage.getItem('statusMsg') || 'å°šæœªè¨­å®š';
  const s = prompt("è¼¸å…¥ç‹€æ…‹è¨Šæ¯", current);
  if(s){
    localStorage.setItem('statusMsg', s);
    document.getElementById('statusMsg').textContent = s;
  }
}

// è¼‰å…¥ Profile
function loadProfile(){
  const a = localStorage.getItem('avatar');
  const b = localStorage.getItem('profileBg');
  if(a) document.getElementById('editAvatar').src = a;
  if(b) document.getElementById('profileBg').src = b;

  document.getElementById('nickname').textContent = localStorage.getItem('nickname') || 'æš±ç¨±';
  document.getElementById('statusMsg').textContent = localStorage.getItem('statusMsg') || 'å°šæœªè¨­å®š';
  document.getElementById('fanId').textContent = getFanId();
}

// æ›é ­åƒ
function changeAvatar(e){
  const f=e.target.files[0];
  if(f){
    const u=URL.createObjectURL(f);
    document.getElementById('editAvatar').src=u;
    localStorage.setItem('avatar',u);
  }
}

// æ›èƒŒæ™¯
function changeBg(e){
  const f=e.target.files[0];
  if(f){
    const u=URL.createObjectURL(f);
    document.getElementById('profileBg').src=u;
    localStorage.setItem('profileBg',u);
  }
}

// è¿”å›ä¸Šä¸€é 
function goBack(){
  history.back();
}

/* ===== Init ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  loadProfile();
  renderDMList();   // é€™è£¡ä¸æœƒå†å ± hasAccess æœªå®šç¾©
  renderLiveList();
  renderStoryBar();
  renderFeed();
  showPage('home');
});

  /* ===== é¦–é æ»¾å‹•æ™‚éš±è—/é¡¯ç¤º nav + story bar ===== */
let lastScroll = 0;
window.addEventListener('scroll', ()=>{
  const nav = document.getElementById('nav');
  const story = document.getElementById('storyBar');
  const current = window.scrollY;

  if(current > lastScroll + 5){ 
    // å¾€ä¸‹æ»‘ â†’ éš±è—
    nav.style.transform = 'translateY(100%)';
    story.style.transform = 'translateY(-100%)';
  } else if(current < lastScroll - 5){
    // å¾€ä¸Šæ»‘ â†’ é¡¯ç¤º
    nav.style.transform = 'translateY(0)';
    story.style.transform = 'translateY(0)';
  }

  lastScroll = current;
});
</script>
</body>
</html>
