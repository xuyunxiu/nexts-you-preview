<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>NEXT‚ÄôS YOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #fff;
      --text: #222;
      --ghost: #999;
      --line: #e5e5e5;
      --primary: #9146ff;
      --fan: #ffffff;
      --artist: #f3e8ff;
      --chip: #f1f1f1;
      --danger: #ff3b30;
      --accent: #9146ff;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    .page { display: none; }
    .active { display: block; }

    /* ===== NAV BAR ===== */
    #navBar {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 56px;
      background: var(--bg);
      border-top: 1px solid var(--line);
      display: flex;
      justify-content: space-around;
      align-items: center;
      font-size: 14px;
      z-index: 99;
      transition: transform 0.3s ease;
    }
    #navBar.hidden { transform: translateY(100%); }
    #navBar button {
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
    }

    /* ===== StoryBar ===== */
    .profileBar {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid var(--line);
      background: var(--bg);
    }
    .profileBar img {
      width: 36px; height: 36px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .storyBar {
      display: flex;
      overflow-x: auto;
      padding: 8px;
      border-bottom: 1px solid var(--line);
      background: var(--bg);
      scrollbar-width: none;
    }
    .storyItem {
      flex: none;
      text-align: center;
      margin-right: 12px;
      cursor: pointer;
    }
    .storyItem img {
      width: 56px; height: 56px;
      border-radius: 50%;
      border: 2px solid var(--primary);
      object-fit: cover;
    }
    .storyItem span {
      display: block;
      font-size: 12px;
      margin-top: 4px;
      color: var(--text);
    }

    /* ===== Post Card ===== */
    .card {
      background: var(--bg);
      border-bottom: 1px solid var(--line);
      padding: 12px;
    }
    .row { display: flex; align-items: center; gap: 8px; }
    .hero {
      width: 100%;
      border-radius: 8px;
      margin-top: 8px;
    }
    .translate-chip {
      margin-left: auto;
      font-size: 12px;
      background: var(--chip);
      border-radius: 12px;
      padding: 2px 8px;
      cursor: pointer;
    }
    .reaction-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 14px;
    }
    .reaction-bar button {
      background: none;
      border: none;
      cursor: pointer;
    }
    .heart-badge {
      font-size: 12px;
      color: var(--danger);
      margin-left: 6px;
    }

    /* ===== Post Detail ===== */
    .comment {
      padding: 8px;
      border-bottom: 1px solid var(--line);
      font-size: 14px;
    }
    .comment .meta {
      font-size: 12px;
      color: var(--ghost);
    }
    .comment-artist { background: var(--artist); border-radius: 6px; padding: 6px; }
    .comment-fan { background: var(--fan); border-radius: 6px; padding: 6px; }

    .profile-popup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 16px;
      z-index: 1000;
      width: 280px;
      display: none;
    }

    /* ===== DM ===== */
    .dmItem {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--line);
      cursor: pointer;
    }
    .dmItem img {
      width: 48px; height: 48px;
      border-radius: 50%;
      margin-right: 12px;
      object-fit: cover;
    }
    .badge {
      background: red;
      color: #fff;
      font-size: 12px;
      border-radius: 50%;
      padding: 2px 6px;
      margin-left: 8px;
    }
    .dmMsg { margin: 6px 0; display: flex; }
    .dmMsg .bubble {
      padding: 8px;
      border-radius: 8px;
      max-width: 70%;
    }
    .dmMsg.fan { justify-content: flex-end; }
    .dmMsg.fan .bubble { background: var(--fan); }
    .dmMsg.artist .bubble { background: var(--artist); }

    /* ===== Live ===== */
    .liveMsg { margin: 6px 0; padding: 8px; border-radius: 6px; max-width: 70%; }
    .liveMsg.host { background: var(--artist); align-self: flex-start; }
    .liveMsg.fan { background: var(--fan); align-self: flex-end; }
    .liveMsg.welcome { background: #ffe9a7; text-align: center; margin: 12px auto; font-size: 12px; }

    /* ===== Replay ===== */
    .replayMsg { margin: 6px 0; padding: 8px; border-radius: 6px; max-width: 70%; }
    .replayMsg.host { background: var(--artist); }
    .replayMsg.fan { background: var(--fan); margin-left:auto; }

    /* ===== Profile ===== */
    .profileHeader {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--line);
    }
    .profileAvatar {
      width: 72px; height: 72px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--line);
      margin-right: 16px;
    }
    .profileMeta { display: flex; flex-direction: column; gap: 4px; }
    .fanId { font-size: 14px; color: var(--ghost); }
    .fanHeart { font-size: 14px; color: var(--danger); }
  </style>
</head>
<body>

  <!-- ===== NAV ===== -->
  <div id="navBar">
    <button onclick="showPage('home')">üè†</button>
    <button onclick="showPage('dmList')">üí¨</button>
    <button onclick="showPage('liveList')">üì∫</button>
    <button onclick="showPage('profilePage')">üë§</button>
  </div>

  <!-- ===== HOME ===== -->
  <div class="page active" id="home">
    <div class="profileBar">
      <img src="default_avatar.png">
      <span id="homeFanId">NEXT-00000</span>
    </div>
    <div class="storyBar" id="storyBar"></div>
    <div id="postFeed"></div>
  </div>

  <!-- ===== POST DETAIL ===== -->
  <div class="page" id="postDetail">
    <div id="postDetailContent"></div>
    <div style="padding:12px;border-top:1px solid var(--line)">
      <label id="filterLabel" style="font-size:12px;color:var(--ghost)">Âè™ÁúãË©≤Ëóù‰∫∫Ë©ïË´ñ</label>
      <div id="commentList" style="margin-top:8px"></div>
      <div class="row" style="margin-top:8px">
        <input id="commentInput" type="text" placeholder="Áïô‰∏ãË©ïË´ñ..." style="flex:1;padding:6px;border:1px solid var(--line);border-radius:6px">
        <button onclick="submitComment()" style="margin-left:8px">ÈÄÅÂá∫</button>
      </div>
    </div>
  </div>
  <div id="profilePopup" class="profile-popup">
    <h3 id="popupName"></h3>
    <p id="popupId"></p>
    <button onclick="closeProfilePopup()">ÈóúÈñâ</button>
  </div>

  <!-- ===== DM LIST ===== -->
  <div class="page" id="dmList">
    <h2>Ë®äÊÅØ <span style="font-size:14px;color:var(--danger)">‚ù§Ô∏è <span id="dmHeartDays">0</span> Â§©</span></h2>
    <div id="dmListContent"></div>
  </div>

  <!-- ===== DM DETAIL ===== -->
  <div class="page" id="dmDetail">
    <div class="row" style="padding:12px;border-bottom:1px solid var(--line)">
      <b id="dmTitle"></b>
    </div>
    <div id="dmBox" style="height:calc(100vh - 160px);overflow-y:auto;padding:12px"></div>
    <div class="row" style="padding:12px;border-top:1px solid var(--line)">
      <input id="dmInput" type="text" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." style="flex:1;padding:6px;border:1px solid var(--line);border-radius:6px">
      <button onclick="sendDm()" style="margin-left:8px">ÈÄÅÂá∫</button>
    </div>
  </div>

  <!-- ===== LIVE ===== -->
  <div class="page" id="liveRoom">
    <div class="row" style="padding:12px;border-bottom:1px solid var(--line)">
      <b id="liveHostName"></b>
      <span id="liveTitle" style="margin-left:8px;color:var(--ghost)"></span>
    </div>
    <div id="liveThread" style="height:calc(100vh - 160px);overflow-y:auto;padding:12px"></div>
    <div class="row" style="padding:12px;border-top:1px solid var(--line)">
      <input id="liveInput" type="text" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." style="flex:1;padding:6px;border:1px solid var(--line);border-radius:6px">
      <button onclick="sendLiveMsg()" style="margin-left:8px">ÈÄÅÂá∫</button>
    </div>
  </div>

  <!-- ===== REPLAY ===== -->
  <div class="page" id="liveReplay">
    <div class="row" style="padding:12px;border-bottom:1px solid var(--line)">
      <b id="replayHostName"></b>
      <span id="replayTitle" style="margin-left:8px;color:var(--ghost)"></span>
      <select id="replaySpeed" onchange="changeReplaySpeed(this.value)" style="margin-left:auto">
        <option value="0.5">0.5x</option>
        <option value="1" selected>1.0x</option>
        <option value="2">2.0x</option>
      </select>
    </div>
    <div id="replayThread" style="height:calc(100vh - 120px);overflow-y:auto;padding:12px"></div>
  </div>

  <!-- ===== PROFILE ===== -->
  <div class="page" id="profilePage">
    <div class="profileHeader">
      <img id="profileAvatar" src="default_avatar.png" class="profileAvatar">
      <div class="profileMeta">
        <div><b id="profileName">Á≤âÁµ≤Êö±Á®±</b></div>
        <div class="fanId" id="fanId">NEXT-00000</div>
        <div class="fanHeart">‚ù§Ô∏è Â∑≤ÊåÅÊúâ <span id="fanHeartDays">0</span> Â§©</div>
      </div>
    </div>
    <div style="padding:16px">
      <label>ÁîüÊó•Ôºö<input type="date" id="birthdayInput" onchange="saveBirthday(this.value)"></label>
    </div>
  </div>

  <script>
    /* ===== ÂÖ±ÈÄö ===== */
    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if (["postDetail","dmDetail","liveRoom","liveReplay"].includes(id)) {
        document.getElementById("navBar").classList.add("hidden");
      } else {
        document.getElementById("navBar").classList.remove("hidden");
      }
      if (id==="profilePage") loadProfile();
      if (id==="dmList") refreshDMList();
    }

    /* ===== Profile ===== */
    function generateFanId() {
      let stored = localStorage.getItem("fanId");
      if (!stored) {
        stored = "NEXT-" + Math.floor(10000 + Math.random()*90000);
        localStorage.setItem("fanId", stored);
      }
      return stored;
    }
    function loadProfile() {
      document.getElementById("fanId").textContent = generateFanId();
      document.getElementById("homeFanId").textContent = localStorage.getItem("fanId");
      document.getElementById("fanHeartDays").textContent = localStorage.getItem("heartDays")||0;
      document.getElementById("dmHeartDays").textContent = localStorage.getItem("heartDays")||0;
      const bd = localStorage.getItem("birthday");
      if (bd) document.getElementById("birthdayInput").value = bd;
      checkBirthday();
    }
    function saveBirthday(val) {
      localStorage.setItem("birthday", val);
      checkBirthday();
    }
    function checkBirthday() {
      const bd = localStorage.getItem("birthday");
      if (!bd) return;
      const today = new Date();
      const [y,m,d] = bd.split("-");
      if (today.getMonth()+1 == parseInt(m) && today.getDate() == parseInt(d)) {
        alert("üéâ ÁîüÊó•Âø´Ê®ÇÔºÅÁ•ù‰Ω†ÊúâÁæéÂ•ΩÁöÑ‰∏ÄÂ§©ÔºÅ");
      }
    }

    /* ===== DM Mock ===== */
    function refreshDMList() {
      const box = document.getElementById("dmListContent");
      box.innerHTML = "";
      const item = document.createElement("div");
      item.className = "dmItem";
      item.innerHTML = '<img src="default_avatar.png"><div class="name">Ëóù‰∫∫A</div><span class="badge">1</span>';
      item.onclick = ()=>openDm("Ëóù‰∫∫A");
      box.appendChild(item);
    }
    function openDm(name) {
      document.getElementById("dmTitle").textContent = name;
      document.getElementById("dmBox").innerHTML = "";
      showPage("dmDetail");
    }
    function sendDm() {
      const input = document.getElementById("dmInput");
      if (!input.value.trim()) return;
      const div = document.createElement("div");
      div.className = "dmMsg fan";
      div.innerHTML = '<div class="bubble">'+input.value+'</div>';
      document.getElementById("dmBox").appendChild(div);
      input.value="";
    }

    /* ===== Live Mock ===== */
    function sendLiveMsg() {
      const input = document.getElementById("liveInput");
      if (!input.value.trim()) return;
      const div = document.createElement("div");
      div.className = "liveMsg fan";
      div.textContent = input.value;
      document.getElementById("liveThread").appendChild(div);
      input.value="";
    }

    /* ===== Replay Mock ===== */
    let replayTimer=null, replayMsgs=[];
    function openReplay() {
      document.getElementById("replayHostName").textContent="Ëóù‰∫∫A";
      document.getElementById("replayTitle").textContent="Áõ¥Êí≠ÂõûÊîæ";
      replayMsgs = [
        {type:"host", text:"Â§ßÂÆ∂Â•ΩÔΩû"},
        {type:"fan", text:"Âó®ÔºÅ"},
        {type:"fan", text:"ÊÑõ‰Ω†üíú"},
        {type:"host", text:"Ë¨ùË¨ùÊîØÊåÅÔºÅ"}
      ];
      playReplay(1);
      showPage("liveReplay");
    }
    function playReplay(speed=1) {
      clearInterval(replayTimer);
      const thread=document.getElementById("replayThread");
      thread.innerHTML="";
      let i=0;
      replayTimer=setInterval(()=>{
        if(i>=replayMsgs.length){clearInterval(replayTimer);return;}
        const m=replayMsgs[i++];
        const div=document.createElement("div");
        div.className="replayMsg "+m.type;
        div.textContent=m.text;
        thread.appendChild(div);
        thread.scrollTop=thread.scrollHeight;
      },2000/speed);
    }
    function changeReplaySpeed(val){ playReplay(parseFloat(val)); }

    /* ===== Init ===== */
    window.onload = ()=>{ showPage("home"); loadProfile(); };
  </script>
</body>
</html>
