<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>NEXTâ€™S YOU â€” Artist</title>
<style>
  /* ç›´æ¥æ²¿ç”¨ç²‰çµ²ç«¯ä¸»é¡Œï¼Œè¦–è¦ºæœƒä¸€æ¨£ */
  :root{--bg:#f5f7ff;--card:#fff;--text:#1a1a1a;--sub:#666;--line:#e6e8ef;--ghost:#9aa0b4;--accent:#6a5acd;--accent2:#836fff;--hover:#eef1ff;--radius:16px;--shadow:0 10px 35px rgba(26,26,26,.08)}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  .page{padding:12px 12px 88px} .row{display:flex;align-items:center;gap:12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)} .soft{padding:16px}
  nav{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top:1px solid var(--line);display:flex;gap:6px;justify-content:space-around;padding:10px 8px 14px}
  nav button{flex:1;border:none;background:transparent;padding:8px 0;border-radius:12px;color:var(--sub);font-weight:800}
  nav button.active{color:var(--accent);background:var(--hover);border:1px solid var(--line)}
  textarea,input[type="text"]{width:100%;border:1px solid var(--line);border-radius:12px;background:var(--hover);padding:12px}
  select{border:1px solid var(--line);border-radius:10px;background:#fff;padding:8px}
  button.primary{border:none;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent2));color:#fff;font-weight:900;padding:10px 16px}
  /* è²¼æ–‡å¡ç‰‡ï¼ˆèˆ‡ç²‰çµ²ç«¯ä¸€è‡´ï¼‰ */
  .postCard{margin:12px 6px}.hdr{display:flex;gap:10px;align-items:center;position:relative}
  .avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;border:1px solid var(--line)}
  .meta b{font-weight:900}.meta small{display:block;color:var(--ghost)}
  .body{margin-top:8px}.hero{width:100%;height:400px;object-fit:cover;border-radius:12px;border:1px solid var(--line)}
  /* åæ‡‰è† å›Šï¼ˆåŒç²‰çµ²ç«¯ç¸®å°ç‰ˆï¼‰ */
  .reaction-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
  .reaction{display:flex;align-items:center;justify-content:space-between;gap:8px;height:36px;padding:6px 10px;border:1px solid var(--line);background:#f7f8ff;border-radius:12px;font-weight:800}
  .reaction .count{margin-left:auto;min-width:2.2em;text-align:right;font-size:12px}
  /* æ·¡ç´« Verifiedï¼ˆé™¤äº† DM ä»¥å¤–éƒ½æœƒé¡¯ç¤ºï¼‰ */
  .v-badge{display:inline-block;margin-left:6px;width:18px;height:18px;border-radius:50%;background:#dcd3ff;color:#fff;position:relative}
  .v-badge:after{content:"âœ“";position:absolute;inset:0;display:grid;place-items:center;font-size:12px;font-weight:900}
</style>
</head>
<body>

<section id="publish" class="page">
  <div class="row" style="justify-content:space-between;margin:2px 0 10px">
    <b style="font-weight:900">ç™¼ä½ˆä¸­å¿ƒï¼ˆè—äººç«¯ï¼‰</b>
  </div>

  <div class="card soft" style="margin-bottom:12px">
    <h3 style="margin:0 0 8px;font-weight:900">ç™¼è²¼æ–‡</h3>
    <div class="row" style="gap:8px;margin:6px 0">
      <select id="artistPick"></select>
      <input id="postTs" type="text" placeholder="æ™‚é–“æ¨™ç±¤ï¼ˆä¾‹å¦‚ï¼šå‰›å‰› / 10å°æ™‚å‰ï¼‰">
    </div>
    <textarea id="postText" rows="4" placeholder="æƒ³èªªä»€éº¼ï¼Ÿ"></textarea>
    <div class="row" style="justify-content:space-between;margin-top:8px">
      <input type="file" id="postImg" accept="image/*">
      <button class="primary" onclick="publishPost()">ç™¼å¸ƒ</button>
    </div>
  </div>

  <div class="card soft">
    <h3 style="margin:0 0 8px;font-weight:900">DM ç¾¤ç™¼ / å€‹åˆ¥</h3>
    <div class="row" style="gap:8px;margin:6px 0">
      <select id="dmTarget"></select>
    </div>
    <input id="dmText" type="text" placeholder="è¼¸å…¥è¨Šæ¯â€¦">
    <div class="row" style="justify-content:flex-end;margin-top:8px">
      <button class="primary" onclick="broadcastDM()">é€å‡º</button>
    </div>
  </div>
</section>

<section id="preview" class="page" style="display:none">
  <div class="row" style="justify-content:space-between;margin:2px 0 10px">
    <b style="font-weight:900">ç²‰çµ²ç«¯é è¦½</b>
    <button class="primary" onclick="renderPreview()">é‡æ–°æ•´ç†</button>
  </div>
  <div id="feedWrap"></div>
</section>

<nav>
  <button id="tabPublish" class="active" onclick="switchTab('publish')">ç™¼ä½ˆ</button>
  <button id="tabPreview" onclick="switchTab('preview')">é è¦½</button>
</nav>

<script>
/* å…±äº«è³‡æ–™ï¼ˆèˆ‡ç²‰çµ²ç«¯ä¸€è‡´ï¼‰ */
const ARTISTS = [
  {id:'annie',name:'Annie',avatar:'https://picsum.photos/80?u=an'},
  {id:'dohee',name:'Dohee',avatar:'https://picsum.photos/80?u=dh'},
  {id:'woo',name:'Woochan',avatar:'https://picsum.photos/80?u=wc'},
  {id:'group',name:'ALLDAY PROJECT',avatar:'https://picsum.photos/80?u=group'}
];

/* LocalStorage DBï¼ˆèˆ‡ç²‰çµ²ç«¯é€éé€™å…©å€‹ key æºé€šï¼‰ */
const DB = {
  getPosts(){ try{return JSON.parse(localStorage.getItem('postsOverride')||'[]')}catch(e){return []} },
  setPosts(list){ localStorage.setItem('postsOverride', JSON.stringify(list)); },
  getDM(){ try{return JSON.parse(localStorage.getItem('dmOverride')||'{}')}catch(e){return {}} },
  setDM(map){ localStorage.setItem('dmOverride', JSON.stringify(map)); }
};

/* åæ‡‰è¨ˆæ•¸éœ€è¦çš„å‹åˆ¥ï¼ˆåªåšé è¦½è¦–è¦ºï¼Œä¸å½±éŸ¿ç²‰çµ²ç«¯äº’å‹•ï¼‰ */
const REACTION_TYPES = [
  {key:'heart',icon:'ğŸ’œ'},{key:'clap',icon:'ğŸ‘'},{key:'laugh',icon:'ğŸ¤£'},
  {key:'panda',icon:'ğŸ¼'},{key:'tear',icon:'ğŸ¥²'},{key:'cheer',icon:'ğŸ¥³'}
];

/* å·¥å…·ï¼šå£“ç¸®åœ–ç‰‡ï¼ˆè¼¸å‡º blob URLï¼‰ */
function compressImage(file, max=1400, cb){
  const img = new Image(), rd = new FileReader();
  rd.onload = e => { img.onload = ()=> {
      let w=img.width,h=img.height; if(w>h&&w>max){h*=max/w;w=max}else if(h>=w&&h>max){w*=max/h;h=max}
      const c=document.createElement('canvas'); c.width=w;c.height=h; c.getContext('2d').drawImage(img,0,0,w,h);
      c.toBlob(b=>cb(URL.createObjectURL(b)),'image/jpeg',0.9);
  }; img.src = e.target.result; }; rd.readAsDataURL(file);
}

/* UI åˆ‡é  */
function switchTab(id){
  document.getElementById('publish').style.display = (id==='publish'?'block':'none');
  document.getElementById('preview').style.display = (id==='preview'?'block':'none');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id==='publish'?'tabPublish':'tabPreview').classList.add('active');
}

/* åˆå§‹åŒ–ä¸‹æ‹‰ */
(function init(){
  const opts = ARTISTS.map(a=>`<option value="${a.id}">${a.name}</option>`).join('');
  document.getElementById('artistPick').innerHTML = opts.replace('group',''); // ç™¼è²¼æ–‡ä¸é¸ group
  document.getElementById('dmTarget').innerHTML =
    `<option value="group">ALLDAYï¼ˆåœ˜é«”ï¼‰</option>` + opts;
  renderPreview();
})();

/* ç™¼å¸ƒè²¼æ–‡ â†’ å¯«å…¥ postsOverride */
function publishPost(){
  const aId = document.getElementById('artistPick').value;
  const text = (document.getElementById('postText').value||'').trim();
  const ts   = (document.getElementById('postTs').value||'å‰›å‰›').trim();
  const file = document.getElementById('postImg').files[0];
  const artist = ARTISTS.find(a=>a.id===aId);
  if(!artist) return alert('è«‹é¸æ“‡è—äºº');
  if(!text && !file) return alert('è«‹è¼¸å…¥æ–‡å­—æˆ–é¸æ“‡åœ–ç‰‡');

  const done = (imgUrl)=>{
    const list = DB.getPosts();
    list.unshift({ id:'p'+Date.now(), artistId:artist.id, artistName:artist.name,
      avatar:artist.avatar, text, img:imgUrl||'', ts:ts||'å‰›å‰›' });
    DB.setPosts(list);
    document.getElementById('postText').value='';
    document.getElementById('postImg').value='';
    renderPreview(); switchTab('preview'); alert('å·²ç™¼å¸ƒ');
  };
  if(file) compressImage(file, 1400, url=>done(url)); else done('');
}

/* DM ç¾¤ç™¼ / å€‹åˆ¥ â†’ å¯«å…¥ dmOverride */
function broadcastDM(){
  const target = document.getElementById('dmTarget').value;
  const text = (document.getElementById('dmText').value||'').trim();
  if(!text) return alert('è«‹è¼¸å…¥è¨Šæ¯');
  const dm = DB.getDM();
  const push = id => {
    dm[id] = dm[id]||[];
    dm[id].push({id:'m'+Date.now(),from:'left',text,ts:Date.now(),translated:false,read:true});
  };
  if(target==='group') push('group'); else push(target);
  DB.setDM(dm);
  document.getElementById('dmText').value='';
  alert('å·²é€å‡º');
}

/* ç²‰çµ²ç«¯é è¦½ï¼ˆå¡ç‰‡æ¨£å¼èˆ‡ index.html ä¸€è‡´ï¼‰ */
function renderPreview(){
  const wrap = document.getElementById('feedWrap');
  const posts = DB.getPosts();
  if(posts.length===0){ wrap.innerHTML = `<div class="card soft" style="margin:12px">å°šç„¡è²¼æ–‡</div>`; return; }
  wrap.innerHTML = posts.map(p=>`
    <div class="card soft postCard">
      <div class="hdr">
        <img class="avatar" src="${p.avatar}">
        <div class="meta"><b>${p.artistName}</b><span class="v-badge"></span><small>${p.ts||''}</small></div>
      </div>
      <div class="body">
        <p>${escapeHtml(p.text||'')}</p>
        ${p.img?`<img class="hero" src="${p.img}">`:''}
        <div class="reaction-bar">
          ${REACTION_TYPES.map(r=>`<div class="reaction"><span>${r.icon}</span><span class="count"></span></div>`).join('')}
        </div>
      </div>
    </div>
  `).join('');
}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
</script>
</body>
</html>
